"use strict";(()=>{var n=(o,t,a)=>new Promise((i,s)=>{var r=_=>{try{g(a.next(_))}catch(L){s(L)}},l=_=>{try{g(a.throw(_))}catch(L){s(L)}},g=_=>_.done?i(_.value):Promise.resolve(_.value).then(r,l);g((a=a.apply(o,t)).next())});var e={MODULE_NAME:"Wild Magic Surge 5e",MODULE_ID:"wild-magic-surge-5e",OPT_WMS_NAME:"wmsName",OPT_TOC_NAME:"tocName",OPT_POWM_NAME:"powmName",OPT_WHISPER_GM:"whisperToGM",OPT_WHISPER_GM_ROLL_CHAT:"whisperToGMRollChat",OPT_TRIGGERMACRO_ENABLE:"enableTriggerMacro",OPT_TRIGGERMACRO_NAME:"triggerMacroName",OPT_ROLLTABLE_ENABLE:"enableRollTable",OPT_ROLLTABLE_NAME:"rollTableName",OPT_POWM_ROLLTABLE_NAME:"powmRollTableName",ROLLTABLE_TYPE:{DEFAULT:"None",AUTO:"Auto Roll Table",PLAYER_TRIGGER:"Player Trigger Roll"},OPT_ENABLE_TOC:"enableTidesOfChaosRecharge",OPT_AUTO_D20:"autoRollD20",OPT_CHAT_MSG:"magicSurgeChatMessage",OPT_CHAT_MSG_ENABLED:"magicSurgeChatMessageEnabled",OPT_AUTO_D20_MSG:"autoRollD20Message",OPT_AUTO_D20_MSG_ENABLED:"autoRollD20MessageEnabled",OPT_AUTO_D20_MSG_NO_SURGE:"autoRollD20MessageNoSurge",OPT_AUTO_D20_MSG_NO_SURGE_ENABLED:"autoRollD20MessageNoSurgeEnabled",OPT_CUSTOM_ROLL_DICE_FORMULA:"customRollDiceFormula",OPT_CUSTOM_ROLL_RESULT:"customRollResult",OPT_CUSTOM_ROLL_RESULT_CHECK:"customRollResultCheck",OPT_INCREMENTAL_CHECK_TO_CHAT:"incrementalCheckToChat",OPT_ENABLE_NPCS:"enableNpcTracking",OPT_TSL_DIE:"OPT_TSL_DIE",OPT_TSL_CANTRIP:"OPT_TSL_CANTRIP",OPT_TSL_LVL1:"OPT_TSL_LVL1",OPT_TSL_LVL2:"OPT_TSL_LVL2",OPT_TSL_LVL3:"OPT_TSL_LVL3",OPT_TSL_LVL4:"OPT_TSL_LVL4",OPT_TSL_LVL5:"OPT_TSL_LVL5",OPT_TSL_LVL6:"OPT_TSL_LVL6",OPT_TSL_LVL7:"OPT_TSL_LVL7",OPT_TSL_LVL8:"OPT_TSL_LVL8",OPT_TSL_LVL9:"OPT_TSL_LVL9",OPT_TSL_LVL10:"OPT_TSL_LVL10",CHAT_TYPE:{DEFAULT:"DEFAULT",ROLL:"ROLL",TABLE:"TABLE"},ROLL_CHECK_TYPE:{DEFAULT:"DEFAULT",SPELL_LEVEL_DEPENDENT_ROLL:"SPELL_LEVEL_DEPENDENT_ROLL",INCREMENTAL_CHECK:"INCREMENTAL_CHECK",INCREMENTAL_CHECK_CHAOTIC:"INCREMENTAL_CHECK_CHAOTIC",DIE_DESCENDING:"DIE_DESCENDING"},SURGE_FEAT_TYPE:{WildMagicSurge:"WMS",PathOfWildMagic:"POWM",TidesOfChaosSurge:"TOCSURGE"},RESOURCE_TYPE:{NONE:"None",PRIMARY:"Primary",SECONDARY:"Secondary",TERTIARY:"Tertiary"},OPT_RESOURCE_TYPE:"OPT_RESOURCE_TYPE",SURGE_TYPE:{DEFAULT:"Standard",SPELL_LEVEL_DEPENDENT_ROLL:"Spell Level Dependent Rolls",INCREMENTAL_CHECK:"Incremental Check",INCREMENTAL_CHECK_CHAOTIC:"Incremental Check (Chaotic)",DIE_DESCENDING:"Descending Dice"},OPT_SURGE_TYPE:"OPT_SURGE_TYPE",MODULE_FLAG_NAME:"wild-magic-surge-5e",DIE_DESCENDING_FLAG_OPTION:"die_type",HAS_SURGED_FLAG_OPTION:"hassurged",ROLL_COMPARISON:{EQ:"=",GT:">",LT:"<"},SPELL_LIST_KEY_WORDS:["Cantrip","1st Level","2nd Level","3rd Level","4th Level","5th Level","6th Level","7th Level","8th Level","9th Level","10th Level"],OPT_SPELL_REGEX:"spellRegex",OPT_SPELL_REGEX_INVERSE:"spellRegexInverse",OPT_SPELL_REGEX_ENABLED:"spellRegexEnabled",OPT_SURGE_TOC_ENABLED:"surgeTocEnabled",OPT_EFFECTS_ENABLED:"wildMagicSurgeEffectsEnabled",OPT_CANTRIP_SURGE_ENABLED:"cantripTriggerSurgeCheckEnabled",OPT_MINIMUM_SPELL_LEVEL_TRIGGER:"minimumSpellLevelTrigger",OPT_ENCOUNTER_STATS_ENABLED:"encounterStatsEnabled",OPT_SHOW_WMS_DEBUG_OPTION:"showWMSDebugOption",COMPARISON:{EQ:"EQ",GT:"GT",LT:"LT"},DIE_VALUE:{D20:"1d20",D12:"1d12",D10:"1d10",D8:"1d8",D6:"1d6",D4:"1d4"},SPELL_LEVELS:{Cantrip:"Cantrip",LEVEL_1:"1st Level",LEVEL_2:"2nd Level",LEVEL_3:"3rd Level",LEVEL_4:"4th Level",LEVEL_5:"5th Level",LEVEL_6:"6th Level",LEVEL_7:"7th Level",LEVEL_8:"8th Level",LEVEL_9:"9th Level",LEVEL_10:"10th Level"}};var d=class{static Call(t,a){Hooks.callAll(`wild-magic-surge-5e.${t}`,a)}};var E=class{static Send(t,a,i,s){return n(this,null,function*(){let r=yield game.settings.get(`${e.MODULE_ID}`,`${e.OPT_WHISPER_GM}`),l=yield game.settings.get(`${e.MODULE_ID}`,`${e.OPT_WHISPER_GM_ROLL_CHAT}`),g=ChatMessage.getWhisperRecipients("GM").map(L=>L.id),_;switch(t){case e.CHAT_TYPE.ROLL:if(!i)return;_=yield this.createRollChat(a,i,r,game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_ENABLE}`)==="PLAYER_TRIGGER");break;case e.CHAT_TYPE.TABLE:if(!i||!s)return;_=yield this.createRollTable(i,s);break;default:_=yield this.createDefaultChat(a);break}(r&&t===e.CHAT_TYPE.ROLL||r&&t===e.CHAT_TYPE.DEFAULT||l&&t===e.CHAT_TYPE.TABLE)&&(_=this.setChatToWhisper(_,g)),_.speaker=g,ChatMessage.create(_)})}static setChatToWhisper(t,a){return t.whisper=a,t.blind=!0,t}static createDefaultChat(t){return n(this,null,function*(){return{content:`<div>${t}</div>`}})}static createRollChat(t,a,i,s=!1){return n(this,null,function*(){var r;return i?{content:`<div>${t} (${(r=a.total)!=null?r:0})</div>`}:{flavor:`${yield game.settings.get(`${e.MODULE_ID}`,`${e.OPT_WMS_NAME}`)} Check - ${t}`,roll:a,rollMode:s?"publicroll":yield game.settings.get("core","rollMode")}})}static createRollTable(t,a){return n(this,null,function*(){let i=t.results,s=t.roll,l={flavor:`Draws ${i.length>1?`${i.length} results`:"a result"} from the <WILD MAGIC SURGE> table.`,user:game.user.id,rolls:[s],sound:null};return l.content=yield this.createTemplate(CONFIG.RollTable.resultTemplate,a,s,i),l})}static createTemplate(t,a,i,s){return n(this,null,function*(){return renderTemplate(t,{description:yield TextEditor.enrichHTML(a.description,{entities:!0,async:!0}),results:s.map(r=>(r.text=r.getChatText(),r)),rollHTML:yield i.render(),table:a})})}static RunMessageCheck(){return n(this,null,function*(){d.Call("CheckForSurge",{value:!0}),game.settings.get(`${e.MODULE_ID}`,`${e.OPT_CHAT_MSG_ENABLED}`)&&(yield this.Send(e.CHAT_TYPE.DEFAULT,game.settings.get(`${e.MODULE_ID}`,`${e.OPT_CHAT_MSG}`)))})}};var b=class{static Check(t){return n(this,null,function*(){if(!game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ENABLE_TOC}`))return;let a=yield this.getTidesOfChaosResource(t);if(a===void 0)return;let i=[];i.push({_id:a.id,"system.uses.value":1,"system.recharge.charged":!0}),yield t.updateEmbeddedDocuments("Item",i),yield t.update({data:{[`${a.resourceName}`]:1}})})}static IsTidesOfChaosUsed(t){return n(this,null,function*(){let a=yield this.getTidesOfChaosResource(t);return a===void 0?!1:a.usesLeft===0})}static IsTidesOfChaosSetup(t){return n(this,null,function*(){let a=!1,i=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TOC_NAME}`),s=yield this.getTidesOfChaosResource(t),r=s!==void 0;if(r&&s){let l=s.resourceName.split(".");l.length===3&&(a=t.system.resources[l[1]].label===i)}return{hasTidesOfChaosResource:a,hasTidesOfChaosFeat:r,isValid:r&&a}})}static getTidesOfChaosResource(t){return n(this,null,function*(){var s,r,l,g;let a=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TOC_NAME}`),i=t.items.find(_=>_.name===a&&_.type==="feat");if(i!==void 0&&(r=(s=i==null?void 0:i.system)==null?void 0:s.consume)!=null&&r.target)return{usesLeft:i.system.uses.value,id:i.id,resourceName:(g=(l=i==null?void 0:i.system)==null?void 0:l.consume)==null?void 0:g.target}})}},p=b;var w=class{static log(t,a="global",i={}){console.log("Wild Magic Surge",a,t,i)}static debug(t,a="global",i={}){console.debug("Wild Magic Surge",a,t,i)}static warn(t,a="global",i={}){console.warn("Wild Magic Surge",a,t,i)}static error(t,a="global",i={}){console.error("Wild Magic Surge",a,t,i)}},m=w;var W=class{static Check(){return n(this,arguments,function*(t=e.SURGE_FEAT_TYPE.WildMagicSurge,a){var i;if(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_ENABLE}`)==="AUTO")if(a.system.details.level>13){let s;return s=(i=yield this.RollOnTable(t))!=null?i:"",s=s+", "+(yield this.RollOnTable(t)),s}else return yield this.RollOnTable(t)})}static RollOnTable(){return n(this,arguments,function*(t=e.SURGE_FEAT_TYPE.WildMagicSurge){let a;if(t===e.SURGE_FEAT_TYPE.PathOfWildMagic?a=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_POWM_ROLLTABLE_NAME}`):a=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_NAME}`),a===void 0){m.error("No roll table name set in settings","rolltablemagicsurge.Check");return}let i=game.tables.find(r=>r.name===a);if(!i){m.error(`No roll table called ${a} found`,"rolltablemagicsurge.Check",game.tables);return}let s=yield i==null?void 0:i.roll().then(r=>(E.Send(e.CHAT_TYPE.TABLE,"",r,i),r));if(s.results.length>0)return s.results[0].text})}},M=W;var f=class{static Reset(t){return n(this,null,function*(){yield this._setupDefault(t)})}static GetResource(t){return n(this,null,function*(){let a=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_RESOURCE_TYPE}`),i=this.defaultValue;switch(a){case"NONE":i=t.getFlag(this.FLAG_NAME,this.FLAG_OPTION);break;case"PRIMARY":i=t.system.resources.primary;break;case"SECONDARY":i=t.system.resources.secondary;break;case"TERTIARY":i=t.system.resources.tertiary;break}return i||(this._setupDefault(t),i=this.defaultValue),i})}static SetResource(t,a){return n(this,null,function*(){let i=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_RESOURCE_TYPE}`),s=this.defaultValue;switch(s.max=a.max,s.value=a.value,i){case"NONE":t.setFlag(this.FLAG_NAME,this.FLAG_OPTION,s);break;case"PRIMARY":t.update({"system.resources.primary":s});break;case"SECONDARY":t.update({"system.resources.secondary":s});break;case"TERTIARY":t.update({"system.resources.tertiary":s});break}})}static _setupDefault(t){return n(this,null,function*(){let a=20;switch(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SURGE_TYPE}`)){case"INCREMENTAL_CHECK_CHAOTIC":a=10;break;case"DIE_DESCENDING":a=6;break}yield this.SetResource(t,{max:a,value:1})})}};f.FLAG_NAME="wild-magic-surge-5e",f.FLAG_OPTION="resource",f.defaultValue={label:"Surge Chance",lr:!1,sr:!1,max:20,value:1};var u=class extends f{static _callChanged(t){return n(this,null,function*(){d.Call("IncrementalCheckChanged",{value:t}),game.settings.get(`${e.MODULE_ID}`,`${e.OPT_INCREMENTAL_CHECK_TO_CHAT}`)&&E.Send(e.CHAT_TYPE.DEFAULT,`${game.i18n.format("WildMagicSurge5E.opt_incremental_check_to_chat_text_name")} ${t}`)})}static Check(t,a,i=20){return n(this,null,function*(){let s=yield this.GetResource(t);return!s||a!==void 0&&a<=s.value?(this._setupDefault(t),!0):(s.value!==i&&(s.value=s.value+1,yield this.SetResource(t,{max:i,value:s.value}),this._callChanged(s.value)),!1)})}};u.FLAG_NAME="wild-magic-surge-5e",u.FLAG_OPTION="surge_increment_resource",u.defaultValue={label:"Surge Chance",lr:!1,sr:!1,max:20,value:1};var h=class{static Check(t,a){let i=this._spellString(a);if(!i)return!1;let s=this._rollFormula(i);if(!s)return this._warnSetup({spellString:i,spellLevel:a}),!1;switch(s==null?void 0:s.equation){case"=":return t===s.target;case">":return t>s.target;case"<":return t<s.target;default:return this._warnSetup({spellString:i,spellLevel:a}),!1}}static ParseRollFormula(t){var r;let a=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_DIE}`);if(!t)return this._warnSetup({spellLevel:t}),a;let i=this._spellString(t);if(!i)return this._warnSetup({spellString:i,spellLevel:t}),a;let s=this._rollFormula(i);return s?(s.roll||(s.roll=a),(r=s.roll)!=null?r:"1D20"):(this._warnSetup({spellString:i,spellLevel:t}),a)}static _rollFormula(t){let a={equation:"",target:0},i=/^([=><]\s\d+)$/g;if(!t.match(i)){let r=/(.*)\s([=><]\s\d+)/,l=t.match(r);if(l&&l.length>1)a.roll=l[1],t=l[2];else return}let s=t.split(" ");return a.equation=s[0],a.target=parseInt(s[1]),a}static _spellString(t){switch(t){case e.SPELL_LEVELS.Cantrip:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_CANTRIP}`);case e.SPELL_LEVELS.LEVEL_1:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL1}`);case e.SPELL_LEVELS.LEVEL_2:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL2}`);case e.SPELL_LEVELS.LEVEL_3:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL3}`);case e.SPELL_LEVELS.LEVEL_4:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL4}`);case e.SPELL_LEVELS.LEVEL_5:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL5}`);case e.SPELL_LEVELS.LEVEL_6:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL6}`);case e.SPELL_LEVELS.LEVEL_7:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL7}`);case e.SPELL_LEVELS.LEVEL_8:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL8}`);case e.SPELL_LEVELS.LEVEL_9:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL9}`);case e.SPELL_LEVELS.LEVEL_10:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL10}`)}}static _warnSetup(t){var a;m.warn("Cannot parse custom Spell Level trigger setting.","spellleveltrigger.Check",t),(a=ui.notifications)==null||a.warn("Wild Magic Surge 5e: Cannot parse custom Spell Level trigger setting. Check console for details.")}};var S=class extends f{static _callChanged(t){return n(this,null,function*(){d.Call("DieDescendingChanged",t)})}static DieFormula(t){return n(this,null,function*(){switch((yield this.GetResource(t)).value){case 1:return e.DIE_VALUE.D20;case 2:return e.DIE_VALUE.D12;case 3:return e.DIE_VALUE.D10;case 4:return e.DIE_VALUE.D8;case 5:return e.DIE_VALUE.D6;case 6:case 7:return e.DIE_VALUE.D4;default:return e.DIE_VALUE.D20}})}static Check(t,a){return n(this,null,function*(){if(!t)return m.warn("Missing actor for Die Descending Check","diedescending.SetupDefault"),!1;let i=yield this.GetResource(t);if(a===1)return yield this._setupDefault(t),!0;switch(i.value){case 1:i.value=2;break;case 2:i.value=3;break;case 3:i.value=4;break;case 4:i.value=5;break;case 5:i.value=6;break;case 6:case 7:i.value=6;break}return yield this.SetResource(t,{max:6,value:i.value}),yield this._callChanged(i),!1})}};S.defaultValue={label:"Surge Chance",lr:!1,sr:!1,max:6,value:1};var y=class{static _isModuleActive(t){var a;return(a=game.modules.get(t))==null?void 0:a.active}static _getJB2AFilePath(){return this._isModuleActive("jb2a_patreon")?["modules/jb2a_patreon/Library/Generic/Energy/SwirlingSparkles_01_Regular_OrangePurple_400x400.webm","modules/jb2a_patreon/Library/Generic/Token_Border/TokenBorderCircleSpin_04_Regular_Blue_400x400.webm","modules/jb2a_patreon/Library/Generic/Marker/EnergyStrands_01_Dark_Green_600x600.webm"]:this._isModuleActive("JB2A_DnD5e")?["modules/JB2A_DnD5e/Library/Generic/Nature/SwirlingLeavesComplete01_02_Regular_Green_400x400.webm","modules/JB2A_DnD5e/Library/Generic/Token_Border/TokenBorderCircleSpin_04_Regular_Blue_400x400.webm","modules/JB2A_DnD5e/Library/Generic/Particles/ParticlesOutward02_03_Regular_GreenYellow_400x400.webm"]:[]}static Run(t){return n(this,null,function*(){var s,r;if(!t||!game.settings.get(`${e.MODULE_ID}`,`${e.OPT_EFFECTS_ENABLED}`))return;if(!this._isModuleActive("sequencer")){(s=ui.notifications)==null||s.info("Wild Magic Surge 5e: Play animation on surge is enabled in settings but the sequencer module is not active/installed. Disable the play animation in settings or install and enable sequencer.");return}if(!this._isModuleActive("JB2A_DnD5e")&&!this._isModuleActive("jb2a_patreon")){(r=ui.notifications)==null||r.info("Wild Magic Surge 5e: Play animation on surge is enabled in settings but the JB2A module is not active/installed. Disable the play animation in settings or install and enable JB2A.");return}let a=this._getJB2AFilePath();new Sequence(e.MODULE_ID).effect().file(`${a[0]}`).duration(1e4).fadeIn(500).fadeOut(1e3).atLocation(t).effect().file(`${a[1]}`).duration(1e4).fadeIn(500).fadeOut(1e3).atLocation(t).effect().file(`${a[2]}`).duration(1e4).fadeIn(500).fadeOut(1e3).atLocation(t).play()})}},G=y;var c=class o{static IsWildMagicFeat(t){let a=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_WMS_NAME}`);return t.items.find(i=>i.name===a&&i.type==="feat")!==void 0}static IsPathOfWildMagicFeat(t){return t.items.find(a=>a.name===game.settings.get(`${e.MODULE_ID}`,`${e.OPT_POWM_NAME}`)&&a.type==="subclass")!==void 0}static SpellDetails(t){var i;let a=parseInt(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_MINIMUM_SPELL_LEVEL_TRIGGER}`));if(((i=t==null?void 0:t.system)==null?void 0:i.level)!==void 0&&!(a>0&&t.system.level<a))switch(t.system.level){case 0:return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_CANTRIP_SURGE_ENABLED}`)?"Cantrip":void 0;case 1:return`${t.system.level}st Level`;case 2:return`${t.system.level}nd Level`;case 3:return`${t.system.level}rd Level`;case 4:case 5:case 6:case 7:case 8:case 9:return`${t.system.level}th Level`;default:return}}static SpellLevel(t){let a=o.SpellDetails(t);return a===void 0?"":a}static IsSpell(t){return o.SpellDetails(t)!==void 0&&t.type==="spell"}static IsSorcererSpell(t){let a=t.name,i=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SPELL_REGEX}`);return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SPELL_REGEX_INVERSE}`)?!(a!=null&&a.match(i)):!!(a!=null&&a.match(i))}static IsRage(t){return t.name==="Rage"}static IsNPC(t){return t?t.type==="npc":!1}};var D=class{constructor(t,a){this._actor=t,this._item=a,this._valid=!1,this._hasPathOfWildMagicFeat=c.IsPathOfWildMagicFeat(this._actor),this._raging=c.IsRage(this._item),this._isASpell=c.IsSpell(this._item),this._spellLevel=c.SpellLevel(this._item),this._isSorcererSpell=c.IsSorcererSpell(this._item),this._hasWildMagicFeat=c.IsWildMagicFeat(this._actor),this._isNpc=c.IsNPC(this._actor)}get spellLevel(){return this._spellLevel}get hasPathOfWildMagicFeat(){return this._hasPathOfWildMagicFeat}get isSorcererSpellRegexMatch(){if(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SPELL_REGEX_ENABLED}`))return this._isSorcererSpell}get valid(){if(this._hasPathOfWildMagicFeat)return this._raging;if(!this._hasWildMagicFeat)return!1;if(this.isSorcererSpellRegexMatch!==void 0)return this._isASpell&&this.isSorcererSpellRegexMatch;let t=this._isASpell;return game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ENABLE_NPCS}`)||(t=t&&!this._isNpc),t}};var v=class{static Run(t,a){return n(this,null,function*(){var g,_;let i=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TRIGGERMACRO_NAME}`);if(!game.settings.get(`${e.MODULE_ID}`,`${e.OPT_TRIGGERMACRO_ENABLE}`)||!i)return;let s=game.macros.find(L=>L.name===i&&L.isOwner);if(!s){m.error(`Trigger Macro ${i} does not exist.`,"TriggerMacro.Run",i);return}let r=(g=game.actors)==null?void 0:g.get(t),l=(_=canvas.tokens)==null?void 0:_.get(a);s.execute({actor:r,token:l})})}},F=v;var k=class{constructor(t,a){this._actor=t,this._tokenId=a}_rollPlayerTrigger(t,a,i=void 0){return n(this,null,function*(){let s="";game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_ENABLE}`)==="PLAYER_TRIGGER"&&(s=`<br /><div class="card-buttons wms-roll-table-buttons">
          <button class="roll-table-wms">
          ${game.i18n.format("WildMagicSurge5E.es_roll_on_table")} ${t}
          </button>
      </div>`),E.Send(a,`${game.settings.get(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG}`)}${s}`,i)})}CheckItem(t){return n(this,null,function*(){let a=new D(this._actor,t);a.valid&&(a.hasPathOfWildMagicFeat?game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_ENABLE}`)==="PLAYER_TRIGGER"?this._rollPlayerTrigger(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_POWM_ROLLTABLE_NAME}`),e.CHAT_TYPE.DEFAULT):M.Check(e.SURGE_FEAT_TYPE.PathOfWildMagic,this._actor):game.settings.get(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20}`)?yield this.AutoSurgeCheck(a.spellLevel,game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SURGE_TYPE}`)):E.RunMessageCheck())})}WildMagicSurgeRollCheck(t){return n(this,null,function*(){let a;switch(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SURGE_TYPE}`)){case e.ROLL_CHECK_TYPE.DIE_DESCENDING:a=yield S.DieFormula(this._actor);break;case e.ROLL_CHECK_TYPE.SPELL_LEVEL_DEPENDENT_ROLL:a=h.ParseRollFormula(t);break;default:a=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_CUSTOM_ROLL_DICE_FORMULA}`);break}if(!a){m.error("Cannot find dice formula","magicsurgecheck.WildMagicSurgeRollCheck");return}let i=this._actor?this._actor.getRollData():{},s=new Roll(a,i);return yield s.evaluate({allowInteractive:!1}),yield s.toMessage(),s})}SplitRollResult(t){return t.toString().replace(/\s/g,"").split(",")}DefaultMagicSurgeRollResult(t,a){let i=t,s=this.SplitRollResult(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_CUSTOM_ROLL_RESULT}`));for(let r of s){let l=parseInt(r);switch(a){case e.COMPARISON.EQ:if(i===l)return!0;break;case e.COMPARISON.GT:if(i>l)return!0;break;case e.COMPARISON.LT:if(i<l)return!0;break}}return!1}AutoSurgeCheck(t,a){return n(this,null,function*(){var l;let i=!1,s,r=!1;if(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SURGE_TOC_ENABLED}`)&&(yield p.IsTidesOfChaosUsed(this._actor))&&(r=!0,this.SurgeTidesOfChaos()),!r){if(s=yield this.WildMagicSurgeRollCheck(t),!s)return;let g=(l=s.total)!=null?l:1;switch(a){case"DEFAULT":i=this.DefaultMagicSurgeRollResult(g,game.settings.get(`${e.MODULE_ID}`,`${e.OPT_CUSTOM_ROLL_RESULT_CHECK}`));break;case"INCREMENTAL_CHECK":case"INCREMENTAL_CHECK_CHAOTIC":{let _=a==="INCREMENTAL_CHECK_CHAOTIC"?10:20;i=yield u.Check(this._actor,g,_);break}case"SPELL_LEVEL_DEPENDENT_ROLL":{i=h.Check(g,t);break}case"DIE_DESCENDING":{i=yield S.Check(this._actor,g);break}default:m.error(`Cannot find gameType ${a}`,"magicsurgecheck.AutoSurgeCheck",a);return}this.SurgeWildMagic(i,s)}})}_callIsSurgeHook(t,a){return n(this,null,function*(){d.Call("IsWildMagicSurge",{surge:t,result:a==null?void 0:a.result,tokenId:this._tokenId,actorId:this._actor.id}),t&&this._actor.id&&F.Run(this._actor.id,this._actor.id)})}SurgeWildMagic(t,a){return n(this,null,function*(){if(t){yield this._actor.setFlag(e.MODULE_FLAG_NAME,e.HAS_SURGED_FLAG_OPTION,!0),game.settings.get(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG_ENABLED}`)&&this._rollPlayerTrigger(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_NAME}`),e.CHAT_TYPE.ROLL,a),p.Check(this._actor);let i=yield M.Check(void 0,this._actor),s=`${game.i18n.format("WildMagicSurge5E.es_wild_magic_surge_with_roll")} ${a==null?void 0:a.result}`;i&&(s=i),this._callIsSurgeHook(!0,a),this._callEncounterStatistic({EventName:game.i18n.format("WildMagicSurge5E.es_wild_magic_surge"),actorId:this._actor.id,FlavorText:s}),G.Run(this._tokenId)}else yield this._actor.setFlag(e.MODULE_FLAG_NAME,e.HAS_SURGED_FLAG_OPTION,!1),game.settings.get(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG_NO_SURGE_ENABLED}`)&&E.Send(e.CHAT_TYPE.ROLL,game.settings.get(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG_NO_SURGE}`),a),this._callIsSurgeHook(!1,a)})}SurgeTidesOfChaos(){return n(this,null,function*(){yield this._actor.setFlag(e.MODULE_FLAG_NAME,e.HAS_SURGED_FLAG_OPTION,!0);let t=yield M.Check(e.SURGE_FEAT_TYPE.TidesOfChaosSurge,this._actor),a=`${game.i18n.format("WildMagicSurge5E.es_tides_of_chaos")}`;t&&(a=t),game.settings.get(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG_ENABLED}`)&&this._rollPlayerTrigger(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_NAME}`),e.CHAT_TYPE.DEFAULT),p.Check(this._actor),u.Reset(this._actor),S.Reset(this._actor),this._callIsSurgeHook(!0),G.Run(this._tokenId),this._callEncounterStatistic({EventName:game.i18n.format("WildMagicSurge5E.es_wild_magic_surge"),actorId:this._actor.id,FlavorText:a})})}_callEncounterStatistic(t){return n(this,null,function*(){var a,i;game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ENCOUNTER_STATS_ENABLED}`)&&((a=game.modules.get("encounter-stats"))!=null&&a.active?Hooks.callAll("encounter-stats.customEvent",{EventName:t.EventName,actorId:t.actorId,FlavorText:t.FlavorText}):(i=ui.notifications)==null||i.info("Wild Magic Surge 5e: Encounter Statistics module is not installed or enabled in settings. Disable sending events in settings or install/enable the Encounter Statistics module."))})}},U=k;var V=class{static Check(t){return n(this,null,function*(){game.settings.get(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20}`)?c.IsWildMagicFeat(t)&&(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ENABLE_NPCS}`)?yield u.Check(t,void 0,10):c.IsNPC(t)||(yield u.Check(t,void 0,10))):yield E.RunMessageCheck()})}},H=V;function T(o){let t=[];for(let a of o){let i=a;for(let[s,r]of game.settings.settings.entries())if(s===`${e.MODULE_ID}.${i}`){let l=game.settings.get(e.MODULE_ID,i),g=[],_=!1;if(r.choices){_=!0;for(let L in r.choices)g.push({key:L.toString(),value:r.choices[L],selected:L.toString()===l})}t.push({module:r.namespace?r.namespace:r.module,key:r.key,type:r.type.name,isBoolean:r.type.name==="Boolean",isString:r.type.name==="String"&&!r.choices,isArray:_,displayname:game.i18n.format(r.name),hint:r.hint?game.i18n.format(r.hint):"",choices:r.choices?r.choices:[],value:l,choicesSelect:g})}}return t}function O(o){for(let t in o){let a=t.split(".");game.settings.set(a[0],a[1],o[t])}}var P=class extends FormApplication{static get defaultOptions(){return mergeObject(super.defaultOptions,{title:game.i18n.format("WildMagicSurge5E.settings_panel_chat_message"),template:"modules/wild-magic-surge-5e/templates/settings.html",id:`${e.MODULE_FLAG_NAME}-chat-settings`,width:520,height:"500",closeOnSubmit:!0})}settingsList(t){return T(t)}getData(){let t=[e.OPT_CHAT_MSG,e.OPT_CHAT_MSG_ENABLED,e.OPT_AUTO_D20_MSG,e.OPT_AUTO_D20_MSG_ENABLED,e.OPT_AUTO_D20_MSG_NO_SURGE,e.OPT_AUTO_D20_MSG_NO_SURGE_ENABLED];return{modules:this.settingsList(t)}}_updateObject(t,a){O(a)}};var A=class extends FormApplication{static get defaultOptions(){return mergeObject(super.defaultOptions,{title:game.i18n.format("WildMagicSurge5E.settings_panel_incremental"),template:"modules/wild-magic-surge-5e/templates/settings.html",id:`${e.MODULE_FLAG_NAME}-chat-settings`,width:520,height:"500",closeOnSubmit:!0})}settingsList(t){return T(t)}getData(){let t=[e.OPT_INCREMENTAL_CHECK_TO_CHAT];return{modules:this.settingsList(t)}}_updateObject(t,a){O(a)}};var R=class extends FormApplication{static get defaultOptions(){return mergeObject(super.defaultOptions,{title:game.i18n.format("WildMagicSurge5E.settings_panel_spell_level_dep"),template:"modules/wild-magic-surge-5e/templates/settings.html",id:`${e.MODULE_FLAG_NAME}-chat-settings`,width:520,height:"500",closeOnSubmit:!0})}settingsList(t){return T(t)}getData(){let t=[e.OPT_TSL_DIE,e.OPT_TSL_CANTRIP,e.OPT_TSL_LVL1,e.OPT_TSL_LVL2,e.OPT_TSL_LVL3,e.OPT_TSL_LVL4,e.OPT_TSL_LVL5,e.OPT_TSL_LVL6,e.OPT_TSL_LVL7,e.OPT_TSL_LVL8,e.OPT_TSL_LVL9,e.OPT_TSL_LVL10];return{modules:this.settingsList(t)}}_updateObject(t,a){O(a)}};var C=class extends FormApplication{static get defaultOptions(){return mergeObject(super.defaultOptions,{title:game.i18n.format("WildMagicSurge5E.settings_panel_standard_phb"),template:"modules/wild-magic-surge-5e/templates/settings.html",id:`${e.MODULE_FLAG_NAME}-chat-settings`,width:520,height:"500",closeOnSubmit:!0})}settingsList(t){return T(t)}getData(){let t=[e.OPT_CUSTOM_ROLL_DICE_FORMULA,e.OPT_CUSTOM_ROLL_RESULT_CHECK,e.OPT_CUSTOM_ROLL_RESULT];return{modules:this.settingsList(t)}}_updateObject(t,a){O(a)}};var I=class extends FormApplication{static get defaultOptions(){return mergeObject(super.defaultOptions,{title:game.i18n.format("WildMagicSurge5E.settings_panel_spell_regex"),template:"modules/wild-magic-surge-5e/templates/settings.html",id:`${e.MODULE_FLAG_NAME}-chat-settings`,width:520,height:"500",closeOnSubmit:!0})}settingsList(t){return T(t)}getData(){let t=[e.OPT_SPELL_REGEX_ENABLED,e.OPT_SPELL_REGEX,e.OPT_SPELL_REGEX_INVERSE];return{modules:this.settingsList(t)}}_updateObject(t,a){O(a)}};var B=class{static Register(){game.settings.register(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20}`,{name:game.i18n.format("WildMagicSurge5E.opt_auto_d20_name"),hint:game.i18n.format("WildMagicSurge5E.opt_auto_d20_hint"),scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_WMS_NAME}`,{name:game.i18n.format("WildMagicSurge5E.opt_wms_feat_name_name"),hint:game.i18n.format("WildMagicSurge5E.opt_wms_feat_name_hint"),scope:"world",config:!0,default:"Wild Magic Surge",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_SPELL_REGEX_ENABLED}`,{name:game.i18n.format("WildMagicSurge5E.opt_enable_spell_regex_name"),hint:game.i18n.format("WildMagicSurge5E.opt_enable_spell_regex_hint"),scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_SPELL_REGEX_INVERSE}`,{name:game.i18n.format("WildMagicSurge5E.opt_spell_regex_inverse_name"),hint:game.i18n.format("WildMagicSurge5E.opt_spell_regex_inverse_hint"),scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_SPELL_REGEX}`,{name:game.i18n.format("WildMagicSurge5E.opt_spell_regex_name"),hint:game.i18n.format("WildMagicSurge5E.opt_spell_regex_hint"),scope:"world",config:!1,default:"\\(S\\)",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_WHISPER_GM}`,{name:game.i18n.format("WildMagicSurge5E.opt_whisper_gm_name"),hint:game.i18n.format("WildMagicSurge5E.opt_whisper_gm_hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_WHISPER_GM_ROLL_CHAT}`,{name:game.i18n.format("WildMagicSurge5E.opt_whisper_gm_roll_chat_name"),hint:game.i18n.format("WildMagicSurge5E.opt_whisper_gm_roll_chat_hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_SURGE_TYPE}`,{name:game.i18n.format("WildMagicSurge5E.opt_surge_type_name"),hint:game.i18n.format("WildMagicSurge5E.opt_surge_type_hint"),scope:"world",config:!0,choices:e.SURGE_TYPE,default:"Default",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_RESOURCE_TYPE}`,{name:game.i18n.format("WildMagicSurge5E.opt_resource_type_name"),hint:game.i18n.format("WildMagicSurge5E.opt_resource_type_hint"),scope:"world",config:!0,choices:e.RESOURCE_TYPE,default:"None",type:String}),game.settings.registerMenu(`${e.MODULE_ID}`,"SpellRegexSettingsPanel",{name:game.i18n.format("WildMagicSurge5E.settings_panel_spell_regex"),label:game.i18n.format("WildMagicSurge5E.configure"),icon:"fas fa-cog",scope:"world",type:I,restricted:!0}),game.settings.registerMenu(`${e.MODULE_ID}`,"StandardSettingsPanel",{name:game.i18n.format("WildMagicSurge5E.settings_panel_standard_phb"),label:game.i18n.format("WildMagicSurge5E.configure"),icon:"fas fa-cog",scope:"world",type:C,restricted:!0}),game.settings.registerMenu(`${e.MODULE_ID}`,"SpellLevelSettingsPanel",{name:game.i18n.format("WildMagicSurge5E.settings_panel_spell_level_dep"),label:game.i18n.format("WildMagicSurge5E.configure"),icon:"fas fa-cog",scope:"world",type:R,restricted:!0}),game.settings.registerMenu(`${e.MODULE_ID}`,"IncrementalSettingsPanel",{name:game.i18n.format("WildMagicSurge5E.settings_panel_incremental"),label:game.i18n.format("WildMagicSurge5E.configure"),icon:"fas fa-cog",scope:"world",type:A,restricted:!0}),game.settings.registerMenu(`${e.MODULE_ID}`,"ChatSettingsPanel",{name:game.i18n.format("WildMagicSurge5E.settings_panel_chat_message"),label:game.i18n.format("WildMagicSurge5E.configure"),icon:"fas fa-cog",scope:"world",type:P,restricted:!0}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_INCREMENTAL_CHECK_TO_CHAT}`,{name:game.i18n.format("WildMagicSurge5E.opt_incremental_check_to_chat_name"),hint:game.i18n.format("WildMagicSurge5E.opt_incremental_check_to_chat_hint"),scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_CHAT_MSG}`,{name:game.i18n.format("WildMagicSurge5E.opt_chat_msg_name"),hint:game.i18n.format("WildMagicSurge5E.opt_chat_msg_hint"),scope:"world",config:!1,default:"Wild Magic Check - Roll a [[/r d20]]",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_CHAT_MSG_ENABLED}`,{name:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_enabled_name"),hint:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_enabled_hint"),scope:"world",config:!1,default:!0,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG}`,{name:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_name"),hint:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_hint"),scope:"world",config:!1,default:"Wild Magic Surge!",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG_ENABLED}`,{name:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_enabled_name"),hint:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_enabled_hint"),scope:"world",config:!1,default:!0,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG_NO_SURGE}`,{name:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_no_surge_name"),hint:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_no_surge_hint"),scope:"world",config:!1,default:"No wild magic surge",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_AUTO_D20_MSG_NO_SURGE_ENABLED}`,{name:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_enabled_name"),hint:game.i18n.format("WildMagicSurge5E.opt_auto_d20_msg_enabled_hint"),scope:"world",config:!1,default:!0,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_ENABLE}`,{name:game.i18n.format("WildMagicSurge5E.opt_rolltable_enabled_name"),hint:game.i18n.format("WildMagicSurge5E.opt_rolltable_enabled_hint"),scope:"world",config:!0,choices:e.ROLLTABLE_TYPE,default:"Default",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_NAME}`,{name:game.i18n.format("WildMagicSurge5E.opt_rolltable_name_name"),hint:game.i18n.format("WildMagicSurge5E.opt_rolltable_name_hint"),scope:"world",config:!0,default:"Wild Magic Surge 5e (PHB)",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_POWM_NAME}`,{name:game.i18n.format("WildMagicSurge5E.opt_powm_feat_name_name"),hint:game.i18n.format("WildMagicSurge5E.opt_powm_feat_name_hint"),scope:"world",config:!0,default:"Path of Wild Magic",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_POWM_ROLLTABLE_NAME}`,{name:game.i18n.format("WildMagicSurge5E.opt_rolltable_powm_name_name"),hint:game.i18n.format("WildMagicSurge5E.opt_rolltable_powm_name_hint"),scope:"world",config:!0,default:"Path of Wild Magic Table",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_CUSTOM_ROLL_DICE_FORMULA}`,{name:game.i18n.format("WildMagicSurge5E.opt_custom_roll_dice_formula_name"),hint:game.i18n.format("WildMagicSurge5E.opt_custom_roll_dice_formula_hint"),scope:"world",config:!1,default:e.DIE_VALUE.D20,type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_CUSTOM_ROLL_RESULT_CHECK}`,{name:game.i18n.format("WildMagicSurge5E.opt_custom_roll_result_check_name"),hint:game.i18n.format("WildMagicSurge5E.opt_custom_roll_result_check_hint"),scope:"world",config:!1,choices:e.ROLL_COMPARISON,default:e.COMPARISON.EQ,type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_CUSTOM_ROLL_RESULT}`,{name:game.i18n.format("WildMagicSurge5E.opt_custom_roll_result_name"),hint:game.i18n.format("WildMagicSurge5E.opt_custom_roll_result_hint"),scope:"world",config:!1,default:"1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_DIE}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_die_name"),hint:game.i18n.format("WildMagicSurge5E.opt_tsl_die_hint"),scope:"world",config:!1,default:e.DIE_VALUE.D20,type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_CANTRIP}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_cantrip_name"),hint:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl1_hint"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL1}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl1_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL2}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl2_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL3}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl3_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL4}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl4_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL5}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl5_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL6}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl6_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL7}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl7_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL8}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl8_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL9}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl9_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TSL_LVL10}`,{name:game.i18n.format("WildMagicSurge5E.opt_tsl_lvl10_name"),scope:"world",config:!1,default:"= 1",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TOC_NAME}`,{name:game.i18n.format("WildMagicSurge5E.opt_toc_feat_name_name"),hint:game.i18n.format("WildMagicSurge5E.opt_toc_feat_name_hint"),scope:"world",config:!0,default:"Tides of Chaos",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_SURGE_TOC_ENABLED}`,{name:game.i18n.format("WildMagicSurge5E.opt_enable_surge_toc_name"),hint:game.i18n.format("WildMagicSurge5E.opt_enable_surge_toc_hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_ENABLE_TOC}`,{name:game.i18n.format("WildMagicSurge5E.opt_enable_toc_name"),hint:game.i18n.format("WildMagicSurge5E.opt_enable_toc_hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_MINIMUM_SPELL_LEVEL_TRIGGER}`,{name:game.i18n.format("WildMagicSurge5E.opt_minimum_spell_level_trigger_name"),hint:game.i18n.format("WildMagicSurge5E.opt_minimum_spell_level_trigger_hint"),scope:"world",config:!0,default:"0",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_CANTRIP_SURGE_ENABLED}`,{name:game.i18n.format("WildMagicSurge5E.opt_cantrip_surge_enabled_name"),hint:game.i18n.format("WildMagicSurge5E.opt_cantrip_surge_enabled_hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_EFFECTS_ENABLED}`,{name:game.i18n.format("WildMagicSurge5E.opt_enable_effects_name"),hint:game.i18n.format("WildMagicSurge5E.opt_enable_effects_hint"),scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_ENABLE_NPCS}`,{name:game.i18n.format("WildMagicSurge5E.opt_enable_npcs_name"),hint:game.i18n.format("WildMagicSurge5E.opt_enable_npcs_hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TRIGGERMACRO_ENABLE}`,{name:game.i18n.format("WildMagicSurge5E.opt_triggermacro_enabled_name"),hint:game.i18n.format("WildMagicSurge5E.opt_triggermacro_enabled_hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_TRIGGERMACRO_NAME}`,{name:game.i18n.format("WildMagicSurge5E.opt_triggermacro_name_name"),hint:game.i18n.format("WildMagicSurge5E.opt_triggermacro_name_hint"),scope:"world",config:!0,default:"WMSMacro",type:String}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_ENCOUNTER_STATS_ENABLED}`,{name:game.i18n.format("WildMagicSurge5E.opt_encounter_stats_enabled_name"),hint:game.i18n.format("WildMagicSurge5E.opt_encounter_stats_enabled_hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register(`${e.MODULE_ID}`,`${e.OPT_SHOW_WMS_DEBUG_OPTION}`,{name:game.i18n.format("WildMagicSurge5E.opt_show_wms_debug_option_name"),hint:game.i18n.format("WildMagicSurge5E.opt_show_wms_debug_option_hint"),scope:"world",config:!0,default:!0,requiresReload:!0,type:Boolean})}},x=B;var N=class extends FormApplication{_updateObject(t,a){throw new Error("Method not implemented.")}static get defaultOptions(){return mergeObject(super.defaultOptions,{title:game.i18n.format("WildMagicSurge5E.settings_panel_information"),template:"modules/wild-magic-surge-5e/templates/ActorHelperPanel.html",id:`${e.MODULE_FLAG_NAME}-actor-help`,width:480,height:"300",closeOnSubmit:!0})}getData(){return n(this,null,function*(){let t=this.object,a=c.IsWildMagicFeat(t),i=yield p.IsTidesOfChaosSetup(t);return{actor:{name:t.name},settings:{isValid:a&&i.isValid,hasWildMagicFeat:a,hasTidesOfChaosResource:i.hasTidesOfChaosResource,hasTidesOfChaosFeat:i.hasTidesOfChaosFeat}}})}};Hooks.on("init",function(){m.log(`Registering ${e.MODULE_NAME} Settings.`,"module.init"),x.Register(),m.log(`Settings for ${e.MODULE_NAME} registered successfully.`,"module.init"),Hooks.on("wild-magic-surge-5e.manualTriggerWMS",function(o,t){return n(this,null,function*(){t&&o&&new U(o,Y(o.id)).SurgeWildMagic(!0,t)})}),Hooks.on("renderChatMessage",function(o,t){return n(this,null,function*(){let a=t.find(".roll-table-wms");a&&a.length>0&&(a.unbind(),a.on("click",i=>{i.preventDefault(),i.stopPropagation(),M.RollOnTable()}))})})});function Y(o){var t,a,i;return(i=(a=(t=canvas.tokens)==null?void 0:t.placeables)==null?void 0:a.find(s=>{var r;return((r=s.actor)==null?void 0:r.id)===o}))==null?void 0:i.id}function j(){let o=game.settings.get(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_ENABLE}`);o==="true"&&game.settings.set(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_ENABLE}`,e.ROLLTABLE_TYPE.AUTO),o==="false"&&game.settings.set(`${e.MODULE_ID}`,`${e.OPT_ROLLTABLE_ENABLE}`,e.ROLLTABLE_TYPE.DEFAULT)}Hooks.once("ready",function(){return n(this,null,function*(){var o,t,a;j(),(o=game.user)!=null&&o.isGM&&((t=game.socket)==null||t.on("module.wild-magic-surge-5e",function(i){return n(this,null,function*(){if(i.event==="SurgeCheck"){let s=i.data,r=game.actors.get(s.actorId);new U(r,s.tokenId).CheckItem(s.item)}})})),Hooks.on("dnd5e.postUseActivity",i=>{var r,l;let s=i.item;if(s.actor){let g=Y(s==null?void 0:s.actor.id);(r=game.user)!=null&&r.isGM?new U(s.actor,g).CheckItem(s):(l=game.socket)==null||l.emit("module.wild-magic-surge-5e",{event:"SurgeCheck",data:{actorId:s==null?void 0:s.actor.id,tokenId:g,item:s}})}}),(a=game.user)!=null&&a.isGM&&Hooks.on("updateCombat",function(i){return n(this,null,function*(){var s,r;if(game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SURGE_TYPE}`)==="INCREMENTAL_CHECK_CHAOTIC"){if(!((s=i.combatant)!=null&&s.actor))return!1;H.Check((r=i.combatant)==null?void 0:r.actor)}})}),Hooks.on("wild-magic-surge-5e.ResetIncrementalCheck",function(i){return n(this,null,function*(){let s=game.actors.get(i);if(!s)return!1;yield u.Reset(s)})}),game.settings.get(`${e.MODULE_ID}`,`${e.OPT_SHOW_WMS_DEBUG_OPTION}`)&&Hooks.on("renderActorSheet",function(i,s,r){return n(this,null,function*(){let l=$('<a class="open-actor-wms" title="Wild Magic Surge 5e Information"><i class="fas fa-wrench"></i>WMS</a>');l.on("click",()=>{new N(i.document,{actor:r.actor}).render(!0)}),s.closest(".app").find(".open-actor-wms").remove();let g=s.closest(".app").find(".window-title");i._minimized||l.insertAfter(g)})})})});})();
//# sourceMappingURL=module.js.map
