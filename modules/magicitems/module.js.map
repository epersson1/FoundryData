{"version":3,"file":"module.js","sources":["../../src/scripts/constants/constants.js","../../src/scripts/lib/Logger.js","../../src/scripts/lib/retrieve-helpers.js","../../src/scripts/lib/lib.js","../../src/scripts/magic-item-helpers.js","../../src/scripts/config.js","../../src/scripts/magic-item-entry/AbstractMagicItemEntry.js","../../src/scripts/magic-item-entry/MagicItemFeat.js","../../src/scripts/utils/number.js","../../src/scripts/magic-item-entry/MagicItemSpell.js","../../src/scripts/magic-item-entry/MagicItemTable.js","../../src/scripts/magic-item/MagicItem.js","../../src/scripts/magicItemtab.js","../../src/scripts/magic-item-owned-entry/AbstractOwnedMagicItemEntry.js","../../src/scripts/magic-item-owned-entry/OwnedMagicItemFeat.js","../../src/scripts/magicitemupcastdialog.js","../../src/scripts/magic-item-owned-entry/OwnedMagicItemSpell.js","../../src/scripts/magic-item-owned-entry/OwnedMagicItemTable.js","../../src/scripts/magic-item/OwnedMagicItem.js","../../src/scripts/magicitemactor.js","../../src/scripts/magicitemsheet.js","../../src/scripts/API/api.js","../../src/scripts/API/migration.js","../../src/module.js"],"sourcesContent":["const CONSTANTS = {\n  MODULE_ID: \"magicitems\",\n  PATH: `modules/magicitems/`,\n  PREFIX_LABEL: \"MAGICITEMS\",\n  // PREFIX_FLAG: \"magicitems\",\n  FLAGS: {\n    DEFAULT: \"default\",\n    SPELLS: \"spells\",\n  },\n  HTML: {\n    MAGIC_ITEM_ICON: '<i class=\"fas fa-magic\" style=\"margin-left: 5px;\" title=\"Magic Item\"></i>',\n  },\n  QUANTITY_PROPERTY_PATH: \"system.quantity\",\n  WEIGHT_PROPERTY_PATH: \"system.weight\",\n  PRICE_PROPERTY_PATH: \"system.price\",\n  SPELL_LEVEL_PROPERTY_PATH: \"system.level\",\n  CURRENT_CHARGES_PATH: \"system.uses.value\",\n  DISPLAY_OPTIONS: {\n    BOTTOM: 0,\n    TOP: 1,\n  },\n};\nCONSTANTS.PATH = `modules/${CONSTANTS.MODULE_NAME}/`;\n\nexport default CONSTANTS;\n","import CONSTANTS from \"../constants/constants.js\";\n\n// ================================\n// Logger utility\n// ================================\nexport default class Logger {\n  static get DEBUG() {\n    return (\n      game.settings.get(CONSTANTS.MODULE_ID, \"debug\") ||\n      game.modules.get(\"_dev-mode\")?.api?.getPackageDebugValue(CONSTANTS.MODULE_ID, \"boolean\")\n    );\n  }\n  // export let debugEnabled = 0;\n  // 0 = none, warnings = 1, debug = 2, all = 3\n\n  static debug(msg, ...args) {\n    try {\n      if (\n        game.settings.get(CONSTANTS.MODULE_ID, \"debug\") ||\n        game.modules.get(\"_dev-mode\")?.api?.getPackageDebugValue(CONSTANTS.MODULE_ID, \"boolean\")\n      ) {\n        console.log(`DEBUG | ${CONSTANTS.MODULE_ID} | ${msg}`, ...args);\n      }\n    } catch (e) {\n      console.error(e.message);\n    }\n    return msg;\n  }\n\n  static logObject(...args) {\n    return this.log(\"\", args);\n  }\n\n  static log(message, ...args) {\n    try {\n      message = `${CONSTANTS.MODULE_ID} | ${message}`;\n      console.log(message.replace(\"<br>\", \"\\n\"), ...args);\n    } catch (e) {\n      console.error(e.message);\n    }\n    return message;\n  }\n\n  static notify(message, ...args) {\n    try {\n      message = `${CONSTANTS.MODULE_ID} | ${message}`;\n      ui.notifications?.notify(message);\n      console.log(message.replace(\"<br>\", \"\\n\"), ...args);\n    } catch (e) {\n      console.error(e.message);\n    }\n    return message;\n  }\n\n  static info(info, notify = false, ...args) {\n    try {\n      info = `${CONSTANTS.MODULE_ID} | ${info}`;\n      if (notify) {\n        ui.notifications?.info(info);\n      }\n      console.log(info.replace(\"<br>\", \"\\n\"), ...args);\n    } catch (e) {\n      console.error(e.message);\n    }\n    return info;\n  }\n\n  static warn(warning, notify = false, ...args) {\n    try {\n      warning = `${CONSTANTS.MODULE_ID} | ${warning}`;\n      if (notify) {\n        ui.notifications?.warn(warning);\n      }\n      console.warn(warning.replace(\"<br>\", \"\\n\"), ...args);\n    } catch (e) {\n      console.error(e.message);\n    }\n    return warning;\n  }\n\n  static errorObject(...args) {\n    return this.error(\"\", false, args);\n  }\n\n  static error(error, notify = true, ...args) {\n    try {\n      error = `${CONSTANTS.MODULE_ID} | ${error}`;\n      if (notify) {\n        ui.notifications?.error(error);\n      }\n      console.error(error.replace(\"<br>\", \"\\n\"), ...args);\n    } catch (e) {\n      console.error(e.message);\n    }\n    return new Error(error.replace(\"<br>\", \"\\n\"));\n  }\n\n  static timelog(message) {\n    this.warn(Date.now(), message);\n  }\n\n  static i18n = (key) => {\n    return game.i18n.localize(key)?.trim();\n  };\n\n  static i18nFormat = (key, data = {}) => {\n    return game.i18n.format(key, data)?.trim();\n  };\n\n  // setDebugLevel = (debugText): void => {\n  //   debugEnabled = { none: 0, warn: 1, debug: 2, all: 3 }[debugText] || 0;\n  //   // 0 = none, warnings = 1, debug = 2, all = 3\n  //   if (debugEnabled >= 3) CONFIG.debug.hooks = true;\n  // };\n\n  static dialogWarning(message, icon = \"fas fa-exclamation-triangle\") {\n    return `<p class=\"${CONSTANTS.MODULE_ID}-dialog\">\n        <i style=\"font-size:3rem;\" class=\"${icon}\"></i><br><br>\n        <strong style=\"font-size:1.2rem;\">${CONSTANTS.MODULE_ID}</strong>\n        <br><br>${message}\n    </p>`;\n  }\n}\n","import Logger from \"./Logger.js\";\n\nexport class RetrieveHelpers {\n  /**\n   *\n   * @param {options}\n   * @param {string} [options.documentName]\n   * @param {string} [options.documentId]\n   * @param {(\"User\"|\"Folder\"|\"Actor\"|\"Item\"|\"Scene\"|\"Combat\"|\"JournalEntry\"|\"Macro\"|\"Playlist\"|\"RollTable\"|\"Cards\"|\"ChatMessage\"|\"Setting\"|\"FogExploration\")} [options.collection]\n   * @param {string} [options.documentPack]\n   * @param {boolean} [options.ignoreError=false]\n   */\n  static retrieveUuid({ documentName, documentId, documentCollectionType, documentPack, ignoreError = false }) {\n    let uuid = null;\n    if (documentCollectionType || pack === \"world\") {\n      const collection = game.collections.get(documentCollectionType);\n      if (!collection) {\n        // DO NOTHING\n        Logger.warn(`Cannot retrieve collection for ${collection}`);\n      } else {\n        // Get the original document, if the name still matches - take no action\n        const original = documentId ? collection.get(documentId) : null;\n        if (original) {\n          if (documentName) {\n            if (original.name !== documentName) {\n              // DO NOTHING\n            } else {\n              return original.uuid;\n            }\n          } else {\n            return original.uuid;\n          }\n        }\n        // Otherwise, find the document by ID or name (ID preferred)\n        const doc = collection.find((e) => e.id === documentId || e.name === documentName) || null;\n        if (doc) {\n          return doc.uuid;\n        }\n      }\n    }\n    if (documentPack) {\n      const pack = RetrieveHelpers.getCompendiumCollectionSync(documentPack, ignoreError);\n      if (!pack) {\n        // DO NOTHING\n        Logger.warn(`Cannot retrieve pack for ${documentPack}`);\n      } else {\n        // Get the original entry, if the name still matches - take no action\n        const original = documentId ? pack.index.get(documentId) : null;\n        if (original) {\n          if (documentName) {\n            if (original.name !== documentName) {\n              // DO NOTHING\n            } else {\n              return original.uuid;\n            }\n          } else {\n            return original.uuid;\n          }\n        }\n\n        // Otherwise, find the document by ID or name (ID preferred)\n        const doc = pack.index.find((i) => i._id === documentId || i.name === documentName) || null;\n        if (doc) {\n          return doc.uuid;\n        }\n      }\n    }\n    return uuid;\n  }\n\n  static getDocument(target) {\n    if (RetrieveHelpers.stringIsUuid(target)) {\n      target = fromUuidSync(target);\n    }\n    return target?.document ?? target;\n  }\n\n  static stringIsUuid(inId) {\n    const valid = typeof inId === \"string\" && (inId.match(/\\./g) || []).length && !inId.endsWith(\".\");\n    if (valid) {\n      return !!fromUuidSync(inId);\n    } else {\n      return false;\n    }\n  }\n\n  static getUuid(target) {\n    if (RetrieveHelpers.stringIsUuid(target)) {\n      return target;\n    }\n    const document = getDocument(target);\n    return document?.uuid ?? false;\n  }\n\n  static getCompendiumCollectionSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`CompendiumCollection is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof CompendiumCollection) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof CompendiumCollection) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      if (game.packs.get(targetTmp)) {\n        targetTmp = game.packs.get(targetTmp);\n      } else if (!ignoreName && game.packs.getName(targetTmp)) {\n        targetTmp = game.packs.getName(targetTmp);\n      }\n    }\n    // }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`CompendiumCollection is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`CompendiumCollection is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof CompendiumCollection)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid CompendiumCollection`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid CompendiumCollection`, true, targetTmp);\n      }\n    }\n    return targetTmp;\n  }\n\n  static async getCompendiumCollectionAsync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`CompendiumCollection is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof CompendiumCollection) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof CompendiumCollection) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = await fromUuid(targetTmp);\n    } else {\n      if (game.packs.get(targetTmp)) {\n        targetTmp = game.packs.get(targetTmp);\n      } else if (!ignoreName && game.packs.getName(targetTmp)) {\n        targetTmp = game.packs.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`CompendiumCollection is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`CompendiumCollection is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof CompendiumCollection)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid CompendiumCollection`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid CompendiumCollection`, true, targetTmp);\n      }\n    }\n    return targetTmp;\n  }\n\n  static getUserSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`User is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof User) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof User) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      if (game.users.get(targetTmp)) {\n        targetTmp = game.users.get(targetTmp);\n      } else if (!ignoreName && game.users.getName(targetTmp)) {\n        targetTmp = game.users.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`User is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`User is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    // if (!(targetTmp instanceof User)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid User`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid User`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp;\n  }\n\n  static getActorSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Actor is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Actor) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Actor) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      if (game.actors.get(targetTmp)) {\n        targetTmp = game.actors.get(targetTmp);\n      } else if (!ignoreName && game.actors.getName(targetTmp)) {\n        targetTmp = game.actors.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Actor is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Actor is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    // if (!(targetTmp instanceof Actor)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid Actor`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid Actor`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp;\n  }\n\n  static async getActorAsync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Actor is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Actor) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Actor) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = await fromUuid(targetTmp);\n    } else {\n      if (game.actors.get(targetTmp)) {\n        targetTmp = game.actors.get(targetTmp);\n      } else if (!ignoreName && game.actors.getName(targetTmp)) {\n        targetTmp = game.actors.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Actor is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Actor is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof Actor)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid Actor`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid Actor`, true, targetTmp);\n      }\n    }\n    return targetTmp;\n  }\n\n  static getJournalSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Journal is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Journal) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Journal) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      if (game.journal.get(targetTmp)) {\n        targetTmp = game.journal.get(targetTmp);\n      } else if (!ignoreName && game.journal.getName(targetTmp)) {\n        targetTmp = game.journal.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Journal is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Journal is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    // if (!(targetTmp instanceof Journal)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid Journal`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid Journal`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp;\n  }\n\n  static async getJournalAsync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Journal is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Journal) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Journal) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = await fromUuid(targetTmp);\n    } else {\n      if (game.journal.get(targetTmp)) {\n        targetTmp = game.journal.get(targetTmp);\n      } else if (!ignoreName && game.journal.getName(targetTmp)) {\n        targetTmp = game.journal.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Journal is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Journal is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof Journal)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid Journal`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid Journal`, true, targetTmp);\n      }\n    }\n    return targetTmp;\n  }\n\n  static getMacroSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Macro is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Macro) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Macro) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      if (game.macros.get(targetTmp)) {\n        targetTmp = game.macros.get(targetTmp);\n      } else if (!ignoreName && game.macros.getName(targetTmp)) {\n        targetTmp = game.macros.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Macro is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Macro is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    // if (!(targetTmp instanceof Macro)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid Macro`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid Macro`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp;\n  }\n\n  static async getMacroAsync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Macro is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Macro) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Macro) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = await fromUuid(targetTmp);\n    } else {\n      if (game.macros.get(targetTmp)) {\n        targetTmp = game.macros.get(targetTmp);\n      } else if (!ignoreName && game.macros.getName(targetTmp)) {\n        targetTmp = game.macros.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Macro is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Macro is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof Macro)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid Macro`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid Macro`, true, targetTmp);\n      }\n    }\n    return targetTmp;\n  }\n\n  static getSceneSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Scene is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Scene) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Scene) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      if (game.scenes.get(targetTmp)) {\n        targetTmp = game.scenes.get(targetTmp);\n      } else if (!ignoreName && game.scenes.getName(targetTmp)) {\n        targetTmp = game.scenes.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Scene is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Scene is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    // if (!(targetTmp instanceof Scene)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid Scene`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid Scene`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp;\n  }\n\n  static async getSceneAsync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Scene is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Scene) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Scene) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = await fromUuid(targetTmp);\n    } else {\n      if (game.scenes.get(targetTmp)) {\n        targetTmp = game.scenes.get(targetTmp);\n      } else if (!ignoreName && game.scenes.getName(targetTmp)) {\n        targetTmp = game.scenes.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Scene is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Scene is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof Scene)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid Scene`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid Scene`, true, targetTmp);\n      }\n    }\n    return targetTmp;\n  }\n\n  static getItemSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Item is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Item) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Item) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      if (game.items.get(targetTmp)) {\n        targetTmp = game.items.get(targetTmp);\n      } else if (!ignoreName && game.items.getName(targetTmp)) {\n        targetTmp = game.items.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Item is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Item is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    // if (!(targetTmp instanceof Item)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid Item`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid Item`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp;\n  }\n\n  static async getItemAsync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Item is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Item) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof Item) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = await fromUuid(targetTmp);\n    } else {\n      if (game.items.get(targetTmp)) {\n        targetTmp = game.items.get(targetTmp);\n      } else if (!ignoreName && game.items.getName(targetTmp)) {\n        targetTmp = game.items.getName(targetTmp);\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Item is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Item is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof Item)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid Item`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid Item`, true, targetTmp);\n      }\n    }\n    return targetTmp;\n  }\n\n  static getPlaylistSoundPathSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`PlaylistSound is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof PlaylistSound) {\n      return targetTmp.path;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof PlaylistSound) {\n      return targetTmp;\n    }\n    if (typeof targetTmp === \"string\" || targetTmp instanceof String) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      targetTmp = game.playlists.contents\n        .flatMap((playlist) => playlist.sounds.contents)\n        .find((playlistSound) => {\n          return playlistSound.id === targetTmp || playlistSound.name === targetTmp;\n        });\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`PlaylistSound is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`PlaylistSound is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    // if (!(targetTmp instanceof PlaylistSound)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid PlaylistSound`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid PlaylistSound`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp.path;\n  }\n\n  static async getPlaylistSoundPathAsync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`PlaylistSound is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof PlaylistSound) {\n      return targetTmp.path;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof PlaylistSound) {\n      return targetTmp;\n    }\n    if (typeof targetTmp === \"string\" || targetTmp instanceof String) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = await fromUuid(targetTmp);\n    } else {\n      targetTmp = game.playlists.contents\n        .flatMap((playlist) => playlist.sounds.contents)\n        .find((playlistSound) => {\n          return playlistSound.id === targetTmp || playlistSound.name === targetTmp;\n        });\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`PlaylistSound is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`PlaylistSound is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof PlaylistSound)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid PlaylistSound`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid PlaylistSound`, true, targetTmp);\n      }\n    }\n    return targetTmp.path;\n  }\n\n  static getTokenSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`Token is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof Token) {\n      return targetTmp;\n    }\n    if (targetTmp instanceof TokenDocument) {\n      targetTmp = targetTmp?.object ?? targetTmp;\n      return targetTmp;\n    }\n    if (targetTmp instanceof Actor) {\n      if (targetTmp.token) {\n        targetTmp = canvas.tokens.get(targetTmp.token);\n      } else {\n        targetTmp = targetTmp.prototypeToken;\n      }\n      if (!targetTmp) {\n        if (ignoreError) {\n          Logger.warn(`Token is not found`, false, targetTmp);\n          return;\n        } else {\n          throw Logger.error(`Token is not found`, true, targetTmp);\n        }\n      }\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n    if (targetTmp instanceof Token) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      targetTmp = canvas.tokens?.placeables.find((t) => {\n        return t.id === target;\n      });\n      if (!ignoreName) {\n        targetTmp = canvas.tokens?.placeables.find((t) => {\n          return t.name === target;\n        });\n      }\n    }\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`Token is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Token is not found`, true, targetTmp);\n      }\n    }\n    targetTmp = targetTmp?.token ?? targetTmp;\n    if (targetTmp instanceof TokenDocument) {\n      targetTmp = targetTmp?.object ?? targetTmp;\n    }\n    // Type checking\n    // if (!(targetTmp instanceof Token)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid Token`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid Token`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp;\n  }\n\n  static getRollTableSync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`RollTable is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof RollTable) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof RollTable) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = fromUuidSync(targetTmp);\n    } else {\n      if (game.tables.get(targetTmp)) {\n        targetTmp = game.tables.get(targetTmp);\n      } else if (!ignoreName && game.tables.getName(targetTmp)) {\n        targetTmp = game.tables.getName(targetTmp);\n      }\n    }\n\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`RollTable is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`RollTable is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    // if (!(targetTmp instanceof RollTable)) {\n    //   if (ignoreError) {\n    //     Logger.warn(`Invalid RollTable`, false, targetTmp);\n    //     return;\n    //   } else {\n    //     throw Logger.error(`Invalid RollTable`, true, targetTmp);\n    //   }\n    // }\n    return targetTmp;\n  }\n\n  static async getRollTableAsync(target, ignoreError = false, ignoreName = true) {\n    let targetTmp = target;\n    if (!targetTmp) {\n      throw Logger.error(`RollTable is undefined`, true, targetTmp);\n    }\n    if (targetTmp instanceof RollTable) {\n      return targetTmp;\n    }\n    // This is just a patch for compatibility with others modules\n    if (targetTmp.document) {\n      targetTmp = targetTmp.document;\n    }\n    if (targetTmp.uuid) {\n      targetTmp = targetTmp.uuid;\n    }\n\n    if (targetTmp instanceof RollTable) {\n      return targetTmp;\n    }\n    if (RetrieveHelpers.stringIsUuid(targetTmp)) {\n      targetTmp = await fromUuid(targetTmp);\n    } else {\n      if (game.tables.get(targetTmp)) {\n        targetTmp = game.tables.get(targetTmp);\n      } else if (!ignoreName && game.tables.getName(targetTmp)) {\n        targetTmp = game.tables.getName(targetTmp);\n      }\n    }\n\n    if (!targetTmp) {\n      if (ignoreError) {\n        Logger.warn(`RollTable is not found`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`RollTable is not found`, true, targetTmp);\n      }\n    }\n    // Type checking\n    if (!(targetTmp instanceof RollTable)) {\n      if (ignoreError) {\n        Logger.warn(`Invalid RollTable`, false, targetTmp);\n        return;\n      } else {\n        throw Logger.error(`Invalid RollTable`, true, targetTmp);\n      }\n    }\n    return targetTmp;\n  }\n}\n","import CONSTANTS from \"../constants/constants.js\";\nimport Logger from \"./Logger.js\";\nimport { RetrieveHelpers } from \"./retrieve-helpers.js\";\n\n// =========================================================================================\n\nexport function isEmptyObject(obj) {\n  // because Object.keys(new Date()).length === 0;\n  // we have to do some additional check\n  if (obj === null || obj === undefined) {\n    return true;\n  }\n  if (isRealNumber(obj)) {\n    return false;\n  }\n  const result =\n    obj && // null and undefined check\n    Object.keys(obj).length === 0; // || Object.getPrototypeOf(obj) === Object.prototype);\n  return result;\n}\n\nexport function getSubstring(string, char1, char2) {\n  return string.slice(string.indexOf(char1) + 1, string.lastIndexOf(char2));\n}\n\n// =========================================================================================\n\nexport async function runMacro(macroReference, ...macroData) {\n  return runMacro(null, macroReference, macroData);\n}\n\nexport async function runMacroOnExplicitActor(explicitActor, macroReference, ...macroData) {\n  let macroFounded = await RetrieveHelpers.getMacroAsync(macroReference, false, true);\n  if (!macroFounded) {\n    throw Logger.error(`Could not find macro with reference \"${macroReference}\"`, true);\n  }\n  // Credit to Otigon, Zhell, Gazkhan and MrVauxs for the code in this section\n  /*\n    let macroId = macro.id;\n    if (macroId.startsWith(\"Compendium\")) {\n      let packArray = macroId.split(\".\");\n      let compendium = game.packs.get(`${packArray[1]}.${packArray[2]}`);\n      if (!compendium) {\n        throw Logger.error(`Compendium ${packArray[1]}.${packArray[2]} was not found`, true);\n      }\n      let findMacro = (await compendium.getDocuments()).find(m => m.name === packArray[3] || m.id === packArray[3])\n      if (!findMacro) {\n        throw Logger.error(`The \"${packArray[3]}\" macro was not found in Compendium ${packArray[1]}.${packArray[2]}`, true);\n      }\n      macro = new Macro(findMacro?.toObject());\n      macro.ownership.default = CONST.DOCUMENT_PERMISSION_LEVELS.OWNER;\n    } else {\n      macro = game.macros.getName(macroId);\n      if (!macro) {\n        throw Logger.error(`Could not find macro with name \"${macroId}\"`, true);\n      }\n    }\n    */\n  let result = false;\n  try {\n    let args = {};\n    if (typeof macroData !== \"object\") {\n      // for (let i = 0; i < macroData.length; i++) {\n      //   args[String(macroData[i]).trim()] = macroData[i].trim();\n      // }\n      args = parseAsArray(macroData);\n    } else {\n      args = macroData;\n    }\n\n    // Little trick to bypass permissions and avoid a socket to run as GM\n    let macroTmp = new Macro(macroFounded.toObject());\n    macroTmp.ownership.default = CONST.DOCUMENT_PERMISSION_LEVELS.OWNER;\n    if (macroTmp.type === \"chat\") {\n      result = await macroTmp.execute(args);\n    } else if (macroTmp.type === \"script\") {\n      //add variable to the evaluation of the script\n      const macro = macroTmp;\n      const actor = explicitActor || getUserCharacter();\n      const speaker = ChatMessage.getSpeaker({ actor: actor });\n      const token = canvas.tokens.get(actor.token);\n      const character = game.user.character;\n      const event = getEvent();\n\n      Logger.debug(\"runMacro | \", { macro, speaker, actor, token, character, event, args });\n\n      //build script execution\n      let body = ``;\n      if (macro.command.trim().startsWith(`(async ()`)) {\n        body = macro.command;\n      } else {\n        body = `(async ()=>{\n            ${macro.command}\n          })();`;\n      }\n      const fn = Function(\"speaker\", \"actor\", \"token\", \"character\", \"event\", \"args\", body);\n\n      Logger.debug(\"runMacro | \", { body, fn });\n\n      //attempt script execution\n      try {\n        fn.call(macro, speaker, actor, token, character, event, args);\n      } catch (err) {\n        Logger.error(`error macro Execution`, true, err);\n      }\n\n      function getEvent() {\n        let a = args[0];\n        if (a instanceof Event) {\n          return args[0].shift();\n        }\n        if (a?.originalEvent instanceof Event) {\n          return args.shift().originalEvent;\n        }\n        return undefined;\n      }\n    } else {\n      Logger.warn(`Something is wrong a macro can be only a 'char' or a 'script'`, true);\n    }\n  } catch (err) {\n    throw Logger.error(`Error when executing macro ${macroReference}!`, true, macroDataArr, err);\n  }\n\n  return result;\n}\n\nexport function getOwnedCharacters(user = false) {\n  user = user || game.user;\n  return game.actors\n    .filter((actor) => {\n      return actor.ownership?.[user.id] === CONST.DOCUMENT_PERMISSION_LEVELS.OWNER && actor.prototypeToken.actorLink;\n    })\n    .sort((a, b) => {\n      return b._stats.modifiedTime - a._stats.modifiedTime;\n    });\n}\n\nexport function getUserCharacter(user = false) {\n  user = user || game.user;\n  return user.character || (user.isGM ? false : getOwnedCharacters(user)?.[0] ?? false);\n}\n\nexport function isValidImage(pathToImage) {\n  const pathToImageS = String(pathToImage);\n  if (pathToImageS.match(CONSTANTS.imageReg) || pathToImageS.match(CONSTANTS.imageRegBase64)) {\n    return true;\n  }\n  return false;\n}\n\nexport function isRealNumber(inNumber) {\n  return !isNaN(inNumber) && typeof inNumber === \"number\" && isFinite(inNumber);\n}\n\nexport function isRealBoolean(inBoolean) {\n  return String(inBoolean) === \"true\" || String(inBoolean) === \"false\";\n}\n\nexport function parseAsArray(obj) {\n  if (!obj) {\n    return [];\n  }\n  let arr = [];\n  if (typeof obj === \"string\" || obj instanceof String) {\n    arr = obj.split(\",\");\n  } else if (obj.constructor === Array) {\n    arr = obj;\n  } else {\n    arr = [obj];\n  }\n  return arr;\n}\n","import CONSTANTS from \"./constants/constants\";\nimport Logger from \"./lib/Logger\";\nimport { isRealNumber, isEmptyObject } from \"./lib/lib.js\";\n\nexport class MagicItemHelpers {\n  static isUsingNew5eSheet(sheet) {\n    return sheet?.constructor?.name === \"ActorSheet5eCharacter2\" || sheet?.constructor?.name === \"ActorSheet5eNPC2\";\n  }\n\n  static isMidiItemEffectWorkflowOn() {\n    return (\n      game.modules.get(\"midi-qol\")?.active && game.settings.get(\"midi-qol\", \"ConfigSettings\")?.autoItemEffects !== \"off\"\n    );\n  }\n\n  static isLevelScalingSettingOn() {\n    return game.settings.get(CONSTANTS.MODULE_ID, \"scaleSpellDamage\");\n  }\n\n  static canSummon() {\n    return game.user.can(\"TOKEN_CREATE\") && (game.user.isGM || game.settings.get(\"dnd5e\", \"allowSummoning\"));\n  }\n\n  static numeric = function (value, fallback) {\n    // if ($.isNumeric(value)) {\n    //   return parseInt(value);\n    // } else {\n    //   return fallback;\n    // }\n    // if is a number\n    if (isRealNumber(value)) {\n      return value;\n    }\n    // if is a string but with a numeric value\n    else if (!isNaN(parseFloat(value)) && isFinite(value)) {\n      return parseInt(value);\n    }\n    // if is something else\n    else {\n      return fallback;\n    }\n  };\n\n  static localized = function (cfg) {\n    return Object.keys(cfg).reduce((i18nCfg, key) => {\n      i18nCfg[key] = game.i18n.localize(cfg[key]);\n      return i18nCfg;\n    }, {});\n  };\n\n  static getEntityNameWithBabele(entity) {\n    if (game.modules.get(\"babele\")?.active) {\n      return game.babele && entity.getFlag(\"babele\", \"hasTranslation\")\n        ? entity.getFlag(\"babele\", \"originalName\")\n        : entity.name;\n    } else {\n      return entity.name;\n    }\n  }\n\n  static getEntityNameCompendiumWithBabele(packToCheck, nameToCheck) {\n    if (game.modules.get(\"babele\")?.active && game.babele?.packs !== undefined) {\n      if (packToCheck !== \"world\" && game.babele?.isTranslated(packToCheck)) {\n        return game.babele.translateField(\"name\", packToCheck, { name: nameToCheck });\n      } else {\n        return nameToCheck;\n      }\n    } else {\n      return nameToCheck;\n    }\n  }\n\n  static sortByName(a, b) {\n    if (a.displayName < b.displayName) {\n      return -1;\n    }\n    if (a.displayName > b.displayName) {\n      return 1;\n    }\n    return 0;\n  }\n\n  static sortByLevel(a, b) {\n    return a.level === b.level ? MagicItemHelpers.sortByName(a, b) : a.level - b.level;\n  }\n\n  static async fetchEntity(entity) {\n    if (entity.pack === \"world\") {\n      const result = await CONFIG[\"Item\"].collection?.instance?.get(entity.id);\n      return result;\n    } else {\n      const pack = game.packs.find((p) => p.collection === entity.pack);\n      if (!pack) {\n        Logger.warn(`Cannot retrieve pack ${entity.pack}`, true);\n      } else {\n        const result = await pack.getDocument(entity.id);\n        return result;\n      }\n    }\n  }\n\n  static async updateMagicItemFlagOnItem(item) {\n    Logger.info(`Updating item ${item.name}`);\n    const itemFlag = foundry.utils.getProperty(item, `flags.${CONSTANTS.MODULE_ID}`);\n    Logger.debug(\"\", itemFlag);\n    let updateItem = false;\n    if (!isEmptyObject(itemFlag)) {\n      if (!isEmptyObject(itemFlag.spells)) {\n        for (const [key, spell] of Object.entries(itemFlag.spells)) {\n          Logger.info(`Updating spell ${spell.name}`);\n          Logger.debug(\"\", spell);\n          const entity = await MagicItemHelpers.fetchEntity(spell);\n          if (entity) {\n            if (!spell.componentsVSM) {\n              Logger.debug(`Entered componentsVSM part ${JSON.stringify(entity?.labels?.components?.vsm)}`);\n              spell.componentsVSM = await entity?.labels?.components?.vsm;\n              Logger.info(`Added componentVSM value to spell ${spell.name}`);\n              updateItem = true;\n            }\n            if (!spell.componentsALL) {\n              Logger.debug(`Entered componentsALL part ${JSON.stringify(entity?.labels?.components?.all)}`);\n              spell.componentsALL = await entity?.labels?.components?.all;\n              Logger.info(`Added componentsALL value to spell ${spell.name}`);\n              updateItem = true;\n            }\n          }\n        }\n      }\n\n      if (!isEmptyObject(itemFlag.feats)) {\n        for (const [key, feat] of Object.entries(itemFlag.feats)) {\n          Logger.info(`Updating feat ${feat.name}`);\n          Logger.debug(\"\", feat);\n          const entity = await MagicItemHelpers.fetchEntity(feat);\n          if (entity) {\n            if (!feat.featAction) {\n              Logger.debug(`Entered featAction part ${JSON.stringify(entity?.labels?.activation)}`);\n              feat.featAction = await entity?.labels?.activation;\n              Logger.info(`Added activation method '${feat.featAction}' for feat: ${feat.name}`);\n              updateItem = true;\n            }\n          }\n        }\n      }\n\n      if (updateItem) {\n        await item.update({\n          flags: {\n            [CONSTANTS.MODULE_ID]: itemFlag,\n          },\n        });\n        Logger.info(`Updated item ${item.name}`);\n      } else {\n        Logger.info(`Update of item ${item.name} skipped - no flags updated`);\n      }\n    }\n  }\n\n  /**\n   * Create details on the summoning profiles and other related options.\n   * Method fetched from D&D5e ability-use-dialog.mjs\n   * @param {Item5e} item  The item.\n   * @returns {{ profiles: object, creatureTypes: object }|null}\n   */\n  static createSummoningOptions(item) {\n    const summons = item.system.summons;\n    if (!summons?.profiles.length) return null;\n    const options = { mode: summons.mode, createSummons: true };\n    const rollData = item.getRollData();\n    const level = summons.relevantLevel;\n    options.profiles = Object.fromEntries(\n      summons.profiles\n        .map((profile) => {\n          if (!summons.mode && !fromUuidSync(profile.uuid)) return null;\n          const withinRange = (profile.level.min ?? -Infinity) <= level && level <= (profile.level.max ?? Infinity);\n          if (!withinRange) return null;\n          return [profile._id, summons.getProfileLabel(profile, rollData)];\n        })\n        .filter((f) => f),\n    );\n    if (Object.values(options.profiles).every((p) => p.startsWith(\"1 × \"))) {\n      Object.entries(options.profiles).forEach(([k, v]) => (options.profiles[k] = v.replace(\"1 × \", \"\")));\n    }\n    if (Object.values(options.profiles).length <= 1) {\n      options.profile = Object.keys(options.profiles)[0];\n      options.profiles = null;\n    }\n    if (summons.creatureSizes.size > 1)\n      options.creatureSizes = summons.creatureSizes.reduce((obj, k) => {\n        obj[k] = CONFIG.DND5E.actorSizes[k]?.label;\n        return obj;\n      }, {});\n    if (summons.creatureTypes.size > 1)\n      options.creatureTypes = summons.creatureTypes.reduce((obj, k) => {\n        obj[k] = CONFIG.DND5E.creatureTypes[k]?.label;\n        return obj;\n      }, {});\n    return options;\n  }\n}\n","export const MAGICITEMS = {};\n\nMAGICITEMS.actors = [];\n\nMAGICITEMS.rechargeUnits = {\n  r1: \"MAGICITEMS.RechargeUnitDaily\",\n  r2: \"MAGICITEMS.RechargeUnitDawn\",\n  r3: \"MAGICITEMS.RechargeUnitSunset\",\n  r4: \"MAGICITEMS.RechargeUnitShortRest\",\n  r5: \"MAGICITEMS.RechargeUnitLongRest\",\n};\n\nMAGICITEMS.DAILY = \"r1\";\nMAGICITEMS.DAWN = \"r2\";\nMAGICITEMS.SUNSET = \"r3\";\nMAGICITEMS.SHORT_REST = \"r4\";\nMAGICITEMS.LONG_REST = \"r5\";\n\nMAGICITEMS.rechargeTypes = {\n  t1: \"MAGICITEMS.RechargeTypeNumeric\",\n  t2: \"MAGICITEMS.RechargeTypeFormula\",\n  t3: \"MAGICITEMS.RechargeTypeFull\",\n};\n\nMAGICITEMS.destroyChecks = {\n  d1: \"MAGICITEMS.DestroyCheckAlways\",\n  d2: \"MAGICITEMS.DestroyCheck1D20\",\n  d3: \"MAGICITEMS.DestroyCheckCustomDC\",\n};\n\nMAGICITEMS.destroyTypes = {\n  dt1: \"MAGICITEMS.JusDestroyType\",\n  dt2: \"MAGICITEMS.LoosePowersType\",\n};\n\nMAGICITEMS.chargeTypes = {\n  c1: \"MAGICITEMS.ChargeTypeWholeItem\",\n  c2: \"MAGICITEMS.ChargeTypePerSpells\",\n};\n\nMAGICITEMS.effects = {\n  e1: \"MAGICITEMS.EffectTypeConsume\",\n  e2: \"MAGICITEMS.EffectTypeDestroy\",\n};\n\nMAGICITEMS.CHARGE_TYPE_WHOLE_ITEM = \"c1\";\nMAGICITEMS.CHARGE_TYPE_PER_SPELL = \"c2\";\n\nMAGICITEMS.NUMERIC_RECHARGE = \"t1\";\nMAGICITEMS.FORMULA_RECHARGE = \"t2\";\nMAGICITEMS.FORMULA_FULL = \"t3\";\n\nMAGICITEMS.tableUsages = {\n  u1: \"MAGICITEMS.TableUsageAsSpell\",\n  u2: \"MAGICITEMS.TableUsageAsFeat\",\n  u3: \"MAGICITEMS.TableUsageTriggerOnUsage\",\n};\n\nMAGICITEMS.TABLE_USAGE_AS_SPELL = \"u1\";\nMAGICITEMS.TABLE_USAGE_AS_FEAT = \"u2\";\nMAGICITEMS.TABLE_USAGE_TRIGGER = \"u3\";\n\nMAGICITEMS.DESTROY_JUST_DESTROY = \"dt1\";\nMAGICITEMS.DESTROY_LOSE_CHARGES = \"dt2\";\n\nMAGICITEMS.RECHARGE_TRANSLATION = {\n  sr: MAGICITEMS.SHORT_REST,\n  lr: MAGICITEMS.LONG_REST,\n  day: MAGICITEMS.DAILY,\n  dawn: MAGICITEMS.DAWN,\n  charges: MAGICITEMS.DAILY,\n  dusk: MAGICITEMS.SUNSET,\n};\n","import CONSTANTS from \"../constants/constants\";\nimport Logger from \"../lib/Logger\";\nimport { RetrieveHelpers } from \"../lib/retrieve-helpers\";\nimport { MagicItemHelpers } from \"../magic-item-helpers\";\n\nexport class AbstractMagicItemEntry {\n  constructor(data) {\n    foundry.utils.mergeObject(this, data);\n    // Patch retrocompatbility\n    if (this.pack?.startsWith(\"magic-items\")) {\n      this.pack = this.pack.replace(\"magic-items-2.\", `${CONSTANTS.MODULE_ID}.`);\n    }\n    // Generate Uuid runtime\n    if (!this.uuid) {\n      try {\n        this.uuid = RetrieveHelpers.retrieveUuid({\n          documentName: this.name,\n          documentId: this.id,\n          documentCollectionType: this.collectionType,\n          documentPack: this.pack,\n          ignoreError: true,\n        });\n      } catch (e) {\n        Logger.error(\"Cannot retrieve uuid\", false, e);\n        this.uuid = \"\";\n      }\n    }\n    this.removed = !RetrieveHelpers.stringIsUuid(this.uuid);\n  }\n\n  get displayName() {\n    return MagicItemHelpers.getEntityNameCompendiumWithBabele(this.pack, this.name);\n  }\n\n  async renderSheet() {\n    this.entity().then((entity) => {\n      entity.ownership.default = CONST.DOCUMENT_OWNERSHIP_LEVELS.LIMITED;\n      const sheet = entity.sheet;\n      sheet.render(true);\n    });\n  }\n\n  entity() {\n    return new Promise((resolve, reject) => {\n      if (this.pack === \"world\") {\n        let entity = this.entityCls().collection?.instance?.get(this.id);\n        if (entity) {\n          resolve(entity);\n        } else {\n          Logger.warn(game.i18n.localize(\"MAGICITEMS.WarnNoMagicItemSpell\") + this.name, true);\n          reject();\n        }\n      } else {\n        const pack = game.packs.find((p) => p.collection === this.pack);\n        if (!pack) {\n          Logger.warn(`Cannot retrieve pack for if ${this.pack}`, true);\n        } else {\n          pack.getDocument(this.id)?.then((entity) => {\n            if (entity) {\n              resolve(entity);\n            } else {\n              Logger.warn(game.i18n.localize(\"MAGICITEMS.WarnNoMagicItemSpell\") + this.name, true);\n              reject();\n            }\n          });\n        }\n      }\n    });\n  }\n\n  entityCls() {\n    return CONFIG[\"Item\"];\n  }\n\n  data() {\n    return new Promise((resolve) => {\n      this.entity().then((entity) => {\n        resolve(entity.toJSON());\n      });\n    });\n  }\n}\n","import { MAGICITEMS } from \"../config\";\nimport Logger from \"../lib/Logger\";\nimport { RetrieveHelpers } from \"../lib/retrieve-helpers\";\nimport { MagicItemHelpers } from \"../magic-item-helpers\";\nimport { AbstractMagicItemEntry } from \"./AbstractMagicItemEntry\";\n\nexport class MagicItemFeat extends AbstractMagicItemEntry {\n  constructor(data) {\n    super(data);\n    this.effect = this.effect ? this.effect : \"e1\";\n    this.featAction = this.featAction;\n  }\n\n  consumptionLabel() {\n    return this.effect === \"e1\"\n      ? `${game.i18n.localize(\"MAGICITEMS.SheetConsumptionConsume\")}: ${this.consumption}`\n      : game.i18n.localize(`MAGICITEMS.SheetConsumptionDestroy`);\n  }\n\n  serializeData() {\n    return {\n      consumption: this.consumption,\n      uuid: this.uuid,\n      id: this.id,\n      img: this.img,\n      name: this.name,\n      pack: this.pack,\n      uses: this.uses,\n      effect: this.effect,\n      featAction: this.featAction,\n    };\n  }\n\n  get effects() {\n    return MagicItemHelpers.localized(MAGICITEMS.effects);\n  }\n}\n","export class NumberUtils {\n  static parseIntOrGetDefault(value, defaultValue) {\n    const parsedValue = parseInt(value);\n    return !isNaN(parsedValue) ? parsedValue : defaultValue;\n  }\n}\n","import { AbstractMagicItemEntry } from \"./AbstractMagicItemEntry\";\nimport { NumberUtils } from \"../utils/number\";\nimport Logger from \"../lib/Logger\";\n\nexport class MagicItemSpell extends AbstractMagicItemEntry {\n  constructor(data) {\n    super(data);\n    this.baseLevel = NumberUtils.parseIntOrGetDefault(this.baseLevel, 0);\n    this.level = NumberUtils.parseIntOrGetDefault(this.level, 0);\n    this.consumption = NumberUtils.parseIntOrGetDefault(this.consumption, 0);\n    this.upcast = this.upcast ? NumberUtils.parseIntOrGetDefault(this.upcast, 0) : this.level;\n    this.upcastCost = this.upcastCost ? NumberUtils.parseIntOrGetDefault(this.upcastCost, 0) : 1;\n    this.dc = this.flatDc && this.dc ? this.dc : \"\";\n    this.componentsVSM = this.componentsVSM;\n    this.componentsALL = this.componentsALL;\n    this.atkBonus = this.checkAtkBonus && this.atkBonus ? this.atkBonus : \"\";\n  }\n\n  get levels() {\n    let levels = {};\n    for (let i = this.baseLevel; i <= 9; i++) {\n      levels[i] = game.i18n.localize(`MAGICITEMS.SheetSpellLevel${i}`);\n      if (i === 0) {\n        break;\n      }\n    }\n    return levels;\n  }\n\n  get upcasts() {\n    let upcasts = {};\n    for (let i = this.level; i <= 9; i++) {\n      upcasts[i] = game.i18n.localize(`MAGICITEMS.SheetSpellUpcast${i}`);\n      if (i === 0) {\n        break;\n      }\n    }\n    return upcasts;\n  }\n\n  get allowedLevels() {\n    let levels = {};\n    for (let i = this.level; i <= Math.min(this.upcast, 9); i++) {\n      levels[i] = game.i18n.localize(`MAGICITEMS.SheetSpellLevel${i}`);\n      if (i === 0) {\n        break;\n      }\n    }\n    return levels;\n  }\n\n  canUpcast() {\n    return this.level < this.upcast;\n  }\n\n  canUpcastLabel() {\n    return this.canUpcast()\n      ? game.i18n.localize(`MAGICITEMS.SheetCanUpcastYes`)\n      : game.i18n.localize(`MAGICITEMS.SheetCanUpcastNo`);\n  }\n\n  consumptionAt(level) {\n    return this.consumption + this.upcastCost * (level - this.level);\n  }\n\n  serializeData() {\n    return {\n      baseLevel: this.baseLevel,\n      consumption: this.consumption,\n      uuid: this.uuid,\n      id: this.id,\n      img: this.img,\n      level: this.level,\n      name: this.name,\n      pack: this.pack,\n      upcast: this.upcast,\n      upcastCost: this.upcastCost,\n      flatDc: this.flatDc,\n      dc: this.dc,\n      uses: this.uses,\n      componentsVSM: this.componentsVSM,\n      componentsALL: this.componentsALL,\n    };\n  }\n}\n","import { MAGICITEMS } from \"../config\";\nimport Logger from \"../lib/Logger\";\nimport { MagicItemHelpers } from \"../magic-item-helpers\";\nimport { AbstractMagicItemEntry } from \"./AbstractMagicItemEntry\";\n\nexport class MagicItemTable extends AbstractMagicItemEntry {\n  entityCls() {\n    return CONFIG[\"RollTable\"];\n  }\n\n  get usages() {\n    return MagicItemHelpers.localized(MAGICITEMS.tableUsages);\n  }\n\n  async roll(actor) {\n    let entity = await this.entity();\n    let result = await entity.draw();\n    if (result && result.results && result.results.length === 1 && result.results[0].collection) {\n      const collectionId = result.results[0].documentCollection;\n      const id = result.results[0].documentId;\n      const pack = game.collections.get(collectionId) || game.packs.get(collectionId);\n      if (!pack) {\n        Logger.warn(`Cannot retrieve pack for if ${collectionId}`, true);\n      } else {\n        const entity = pack.getDocument ? await pack.getDocument(id) : pack.get(id);\n        if (entity) {\n          let item = (await actor.createEmbeddedDocuments(\"Item\", [entity]))[0];\n          const chatData = await item.use({}, { createMessage: false });\n\n          if (!game.modules.get(\"ready-set-roll-5e\")?.active) {\n            ChatMessage.create(\n              foundry.utils.mergeObject(chatData, {\n                \"flags.dnd5e.itemData\": item,\n              }),\n            );\n          }\n        }\n      }\n    }\n  }\n\n  serializeData() {\n    return {\n      consumption: this.consumption,\n      id: this.id,\n      uuid: this.uuid,\n      img: this.img,\n      name: this.name,\n      pack: this.pack,\n    };\n  }\n}\n","import { MAGICITEMS } from \"../config.js\";\nimport { RetrieveHelpers } from \"../lib/retrieve-helpers.js\";\nimport { MagicItemFeat } from \"../magic-item-entry/MagicItemFeat.js\";\nimport { MagicItemSpell } from \"../magic-item-entry/MagicItemSpell.js\";\nimport { MagicItemTable } from \"../magic-item-entry/MagicItemTable.js\";\nimport { MagicItemHelpers } from \"../magic-item-helpers.js\";\nimport { NumberUtils } from \"../utils/number.js\";\n\nexport class MagicItem {\n  constructor(flagsData) {\n    const data = foundry.utils.mergeObject(this.defaultData(), flagsData || {}, { inplace: false });\n\n    this.enabled = data.enabled;\n    this.equipped = data.equipped;\n    this.attuned = data.attuned;\n    this.internal = data.internal;\n    this.charges = NumberUtils.parseIntOrGetDefault(data.charges, 0);\n    this.chargeType = data.chargeType;\n    this.rechargeable = data.rechargeable;\n    this.recharge = data.recharge;\n    this.rechargeType = data.rechargeType;\n    this.rechargeUnit = data.rechargeUnit;\n    this.destroy = data.destroy;\n    this.destroyCheck = data.destroyCheck;\n    this.destroyType = data.destroyType;\n    this.destroyFlavorText = data.destroyFlavorText;\n    this.destroyDC = data.destroyDC;\n    this.sorting = data.sorting;\n    this.sortingModes = { l: \"MAGICITEMS.SheetSortByLevel\", a: \"MAGICITEMS.SheetSortAlphabetically\" };\n\n    this.spells = Object.values(data.spells ? data.spells : {})\n      .filter((spell) => spell !== \"null\")\n      .map((spell) => {\n        spell.collectionType = \"Item\";\n        return new MagicItemSpell(spell);\n      });\n\n    this.feats = Object.values(data.feats ? data.feats : {})\n      .filter((feat) => feat !== \"null\")\n      .map((feat) => {\n        feat.collectionType = \"Item\";\n        return new MagicItemFeat(feat);\n      });\n\n    this.tables = Object.values(data.tables ? data.tables : {})\n      .filter((table) => table !== \"null\")\n      .map((table) => {\n        table.collectionType = \"RollTable\";\n        return new MagicItemTable(table);\n      });\n\n    this.spellsGarbage = [];\n    this.featsGarbage = [];\n    this.tablesGarbage = [];\n\n    this.savedSpells = this.spells.length;\n    this.savedFeats = this.feats.length;\n    this.savedTables = this.tables.length;\n\n    this.sort();\n\n    if (!this.enabled) {\n      this.clear();\n    }\n  }\n\n  sort() {\n    if (this.sorting === \"a\") {\n      this.spells = this.spells.sort(MagicItemHelpers.sortByName);\n    }\n    if (this.sorting === \"l\") {\n      this.spells = this.spells.sort(MagicItemHelpers.sortByLevel);\n    }\n  }\n\n  get destroyTarget() {\n    return this.chargeType === \"c1\"\n      ? game.i18n.localize(\"MAGICITEMS.SheetObjectTarget\")\n      : game.i18n.localize(\"MAGICITEMS.SheetSpellTarget\");\n  }\n\n  defaultData() {\n    return {\n      enabled: false,\n      equipped: false,\n      internal: false,\n      attuned: false,\n      charges: 0,\n      chargeType: \"c1\",\n      rechargeable: false,\n      recharge: 0,\n      rechargeType: \"t1\",\n      rechargeUnit: \"\",\n      destroy: false,\n      destroyCheck: \"d1\",\n      destroyType: \"dt1\",\n      destroyDC: 0,\n      destroyFlavorText: game.i18n.localize(\"MAGICITEMS.MagicItemDestroy\"),\n      sorting: \"l\",\n      spells: {},\n      feats: {},\n      tables: {},\n    };\n  }\n\n  serializeData() {\n    return {\n      enabled: this.enabled,\n      charges: this.charges,\n      chargeType: this.chargeType,\n      internal: this.internal,\n      rechargeable: this.rechargeable,\n      recharge: this.recharge,\n      rechargeType: this.rechargeType,\n      rechargeUnit: this.rechargeUnit,\n      destroy: this.destroy,\n      destroyCheck: this.destroyCheck,\n      destroyType: this.destroyType,\n      destroyFlavorText: this.destroyFlavorText,\n      destroyDC: this.destroyDC,\n      sorting: this.sorting,\n      spells: this.serializeEntries(this.spells, this.spellsGarbage),\n      feats: this.serializeEntries(this.feats, this.featsGarbage),\n      tables: this.serializeEntries(this.tables, this.tablesGarbage),\n      uses: this.uses,\n    };\n  }\n\n  serializeEntries(entries, trash) {\n    let data = {};\n    entries.forEach((entry, idx) => (data[\"\" + idx] = entry.serializeData()));\n    trash.forEach((index) => (data[\"-=\" + index] = null));\n    return data;\n  }\n\n  get chargeTypes() {\n    return MagicItemHelpers.localized(MAGICITEMS.chargeTypes);\n  }\n\n  get destroyChecks() {\n    return MagicItemHelpers.localized(MAGICITEMS.destroyChecks);\n  }\n\n  get destroyTypes() {\n    return MagicItemHelpers.localized(MAGICITEMS.destroyTypes);\n  }\n\n  get rechargeUnits() {\n    return MagicItemHelpers.localized(MAGICITEMS.rechargeUnits);\n  }\n\n  get rechargeTypes() {\n    return MagicItemHelpers.localized(MAGICITEMS.rechargeTypes);\n  }\n\n  get rechargeText() {\n    return this.rechargeType === \"t3\" ? game.i18n.localize(\"MAGICITEMS.RechargeTypeFull\") : this.recharge;\n  }\n\n  get empty() {\n    return this.spells.length === 0 && this.feats.length === 0 && this.tables.length === 0;\n  }\n\n  get chargesOnWholeItem() {\n    return this.chargeType === MAGICITEMS.CHARGE_TYPE_WHOLE_ITEM;\n  }\n\n  get chargesPerSpell() {\n    return this.chargeType === MAGICITEMS.CHARGE_TYPE_PER_SPELL;\n  }\n\n  toggleEnabled(enabled) {\n    this.enabled = enabled;\n    if (!enabled) {\n      this.clear();\n    }\n  }\n\n  toggleRechargeable(rechargeable) {\n    this.rechargeable = rechargeable;\n    if (!rechargeable) {\n      this.recharge = 0;\n      this.rechargeType = \"t1\";\n      this.rechargeUnit = \"\";\n    }\n  }\n\n  clear() {\n    foundry.utils.mergeObject(this, this.defaultData());\n    this.spells = [];\n    this.feats = [];\n    this.tables = [];\n    this.cleanup();\n  }\n\n  support(type) {\n    return [\"Item\", \"RollTable\"].includes(type);\n  }\n\n  get items() {\n    return this.spells.concat(this.feats).concat(this.tables);\n  }\n\n  addSpell(data) {\n    data.collectionType = \"Item\";\n    this.spells.push(new MagicItemSpell(data));\n    this.cleanup();\n  }\n\n  removeSpell(idx) {\n    this.spells.splice(idx, 1);\n    this.cleanup();\n  }\n\n  get hasSpells() {\n    return this.spells.length > 0 || this.hasTableAsSpells;\n  }\n\n  hasSpell(spellId) {\n    return this.spells.filter((spell) => spell.id === spellId).length === 1;\n  }\n\n  addFeat(data) {\n    data.collectionType = \"Item\";\n    this.feats.push(new MagicItemFeat(data));\n    this.cleanup();\n  }\n\n  removeFeat(idx) {\n    this.feats.splice(idx, 1);\n    this.cleanup();\n  }\n\n  get hasFeats() {\n    return this.feats.length > 0 || this.hasTableAsFeats;\n  }\n\n  hasFeat(featId) {\n    return this.feats.filter((feat) => feat.id === featId).length === 1;\n  }\n\n  addTable(data) {\n    data.collectionType = \"RollTable\";\n    this.tables.push(new MagicItemTable(data));\n    this.cleanup();\n  }\n\n  removeTable(idx) {\n    this.tables.splice(idx, 1);\n    this.cleanup();\n  }\n\n  get hasTableAsSpells() {\n    return this.tableAsSpells.length === 1;\n  }\n\n  get hasTableAsFeats() {\n    return this.tableAsFeats.length === 1;\n  }\n\n  hasTable(tableId) {\n    return this.tables.filter((table) => table.id === tableId).length === 1;\n  }\n\n  tablesByUsage(usage) {\n    return this.tables.filter((table) => table.usage === usage);\n  }\n\n  get tableAsSpells() {\n    return this.tablesByUsage(MAGICITEMS.TABLE_USAGE_AS_SPELL);\n  }\n\n  get tableAsFeats() {\n    return this.tablesByUsage(MAGICITEMS.TABLE_USAGE_AS_FEAT);\n  }\n\n  get triggeredTables() {\n    return this.tablesByUsage(MAGICITEMS.TABLE_USAGE_TRIGGER);\n  }\n\n  compatible(entity) {\n    return ([\"spell\", \"feat\"].includes(entity.type) || entity.documentName === \"RollTable\") && !this.hasItem(entity.id);\n  }\n\n  addEntity(entity, pack) {\n    let name = MagicItemHelpers.getEntityNameWithBabele(entity);\n    if (entity.type === \"spell\") {\n      this.addSpell({\n        uuid: entity.uuid,\n        id: entity.id,\n        name: name,\n        img: entity.img,\n        pack: pack,\n        baseLevel: entity.system.level,\n        level: entity.system.level,\n        consumption: entity.system.level,\n        upcast: entity.system.level,\n        upcastCost: 1,\n        componentsVSM: entity?.labels?.components?.vsm,\n        componentsALL: entity?.labels?.components?.all,\n      });\n      return true;\n    }\n    if (entity.type === \"feat\") {\n      this.addFeat({\n        uuid: entity.uuid,\n        id: entity.id,\n        name: name,\n        img: entity.img,\n        pack: pack,\n        effect: \"e1\",\n        consumption: 1,\n        featAction: entity?.labels?.activation,\n      });\n      return true;\n    }\n    if (entity.documentName === \"RollTable\") {\n      this.addTable({\n        uuid: entity.uuid,\n        id: entity.id,\n        name: name,\n        img: entity.img,\n        pack: pack,\n        consumption: 1,\n      });\n      return true;\n    }\n    return false;\n  }\n\n  hasItem(itemId) {\n    return this.hasSpell(itemId) || this.hasFeat(itemId) || this.hasTable(itemId);\n  }\n\n  findByUuid(itemUuid) {\n    return this.items.filter((item) => item.uuid === itemUuid)[0];\n  }\n\n  findById(itemId) {\n    return this.items.filter((item) => item.id === itemId)[0];\n  }\n\n  get sheetEditable() {\n    return $(this.actor.sheet.form).hasClass(\"editable\");\n  }\n\n  async renderSheet(itemId) {\n    let item = this.findByUuid(itemId);\n    if (!item) {\n      item = this.findById(itemId);\n    }\n\n    await item.renderSheet();\n  }\n\n  cleanup() {\n    this.spellsGarbage = [];\n    this.featsGarbage = [];\n    this.tablesGarbage = [];\n    if (this.savedSpells > this.spells.length) {\n      for (let i = this.spells.length; i < this.savedSpells; i++) {\n        this.spellsGarbage.push(i);\n      }\n    }\n    if (this.savedFeats > this.feats.length) {\n      for (let i = this.feats.length; i < this.savedFeats; i++) {\n        this.featsGarbage.push(i);\n      }\n    }\n    if (this.savedTables > this.tables.length) {\n      for (let i = this.tables.length; i < this.savedTables; i++) {\n        this.tablesGarbage.push(i);\n      }\n    }\n  }\n\n  async updateInternalCharges(isChecked, item) {\n    let itemData = await RetrieveHelpers.getItemAsync(item);\n    const itemChargeData = itemData.system.uses;\n    if (isChecked && itemChargeData?.per) {\n      this.charges = itemChargeData.max;\n      this.uses = itemChargeData.value;\n      this.chargeType = MAGICITEMS.CHARGE_TYPE_WHOLE_ITEM;\n      this.rechargeable = false;\n      this.recharge = itemChargeData.recovery;\n      this.rechargeType = this.chargesTypeCompatible(itemChargeData);\n      this.rechargeUnit = MAGICITEMS.RECHARGE_TRANSLATION[itemChargeData.per];\n    } else if (isChecked && !itemChargeData?.per) {\n      this.charges = 0;\n      this.uses = 0;\n      this.chargeType = MAGICITEMS.CHARGE_TYPE_WHOLE_ITEM;\n      this.rechargeable = false;\n      this.rechargeUnit = \"\";\n      this.rechargeType = MAGICITEMS.NUMERIC_RECHARGE;\n    }\n  }\n\n  chargesTypeCompatible(chargeData) {\n    if ([\"lr\", \"sr\", \"day\"].includes(chargeData.per)) {\n      return MAGICITEMS.FORMULA_FULL;\n    } else if (NumberUtils.parseIntOrGetDefault(chargeData.recovery, 0) !== 0) {\n      return MAGICITEMS.NUMERIC_RECHARGE;\n    } else {\n      return MAGICITEMS.FORMULA_RECHARGE;\n    }\n  }\n}\n","import CONSTANTS from \"./constants/constants.js\";\nimport { MagicItem } from \"./magic-item/MagicItem.js\";\nimport Logger from \"./lib/Logger.js\";\n\nconst magicItemTabs = [];\n\nexport class MagicItemTab {\n  static bind(app, html, item) {\n    if (MagicItemTab.isAcceptedItemType(item.document)) {\n      let tab = magicItemTabs[app.id];\n      if (!tab) {\n        tab = new MagicItemTab(app);\n        magicItemTabs[app.id] = tab;\n      }\n      tab.init(html, item, app);\n    }\n  }\n\n  constructor(app) {\n    this.hack(app);\n    this.activate = false;\n  }\n\n  init(html, data, app) {\n    this.item = app.item;\n    this.html = html;\n    this.editable = data.editable;\n\n    if (html[0].localName !== \"div\") {\n      html = $(html[0].parentElement.parentElement);\n    }\n    let tabs = html.find(`form nav.sheet-navigation.tabs`);\n    if (tabs.find(`a[data-tab=${CONSTANTS.MODULE_ID}]`).length > 0) {\n      return; // already initialized, duplication bug!\n    }\n\n    tabs.append($(`<a class=\"item\" data-tab=\"${CONSTANTS.MODULE_ID}\">Magic Item</a>`));\n\n    $(html.find(`.sheet-body`)).append(\n      $(`<div class=\"tab magicitems\" data-group=\"primary\" data-tab=\"${CONSTANTS.MODULE_ID}\"></div>`),\n    );\n\n    if (this.editable) {\n      const dragDrop = new DragDrop({\n        dropSelector: \".tab.magicitems\",\n        permissions: {\n          dragstart: this._canDragStart.bind(app),\n          drop: this._canDragDrop.bind(app),\n        },\n        callbacks: {\n          dragstart: app._onDragStart.bind(app),\n          dragover: app._onDragOver.bind(app),\n          drop: (event) => {\n            this.activate = true;\n            MagicItemTab.onDrop({\n              event: event,\n              item: this.item,\n              magicItem: this.magicItem,\n            });\n          },\n        },\n      });\n\n      app._dragDrop.push(dragDrop);\n      dragDrop.bind(app.form);\n    }\n    const flagsData = foundry.utils.getProperty(app.item, `flags.${CONSTANTS.MODULE_ID}`);\n    this.magicItem = new MagicItem(flagsData);\n\n    this.render(app);\n  }\n\n  hack(app) {\n    let tab = this;\n    app.setPosition = function (position = {}) {\n      position.height = tab.isActive() && !position.height ? \"auto\" : position.height;\n      let that = this;\n      for (let i = 0; i < 100; i++) {\n        if (that.constructor.name === ItemSheet.name) {\n          break;\n        }\n        that = Object.getPrototypeOf(that);\n      }\n      return that.setPosition.apply(this, [position]);\n    };\n  }\n\n  async render(app) {\n    let template = await renderTemplate(`modules/${CONSTANTS.MODULE_ID}/templates/magic-item-tab.hbs`, this.magicItem);\n    let el = this.html.find(`.magicitems-content`);\n    if (el.length) {\n      el.replaceWith(template);\n    } else {\n      this.html.find(\".tab.magicitems\").append(template);\n    }\n\n    if (this.editable) {\n      this.activateTabManagementListeners();\n      MagicItemTab.activateTabContentsListeners({\n        html: this.html,\n        item: this.item,\n        magicItem: this.magicItem,\n        onItemUpdatingCallback: () => {\n          this.activate = true;\n        },\n      });\n    } else {\n      MagicItemTab.disableMagicItemTabInputs(this.html);\n    }\n\n    if (this.activate && !this.isActive()) {\n      app._tabs[0].activate(`${CONSTANTS.MODULE_ID}`);\n      app.setPosition();\n    }\n\n    this.activate = false;\n  }\n\n  isActive() {\n    return $(this.html).find(`a.item[data-tab=\"${CONSTANTS.MODULE_ID}\"]`).hasClass(\"active\");\n  }\n\n  _canDragDrop() {\n    return true;\n  }\n\n  _canDragStart() {\n    return true;\n  }\n\n  activateTabManagementListeners() {\n    this.html.find(\".magicitems-content\").on(\"change\", \":input\", (evt) => {\n      this.activate = true;\n    });\n  }\n\n  /**\n   * Disable all relevant inputs in the magic items tab.\n   */\n  static disableMagicItemTabInputs(html) {\n    html.find(\".magicitems-content input\").prop(\"disabled\", true);\n    html.find(\".magicitems-content select\").prop(\"disabled\", true);\n  }\n\n  /**\n   * Handles drop event for compatible magic item source (for example, a spell).\n   *\n   * @param {object} params Parameters needed to handle item drops to the magic item tab.\n   * @param {DragEvent} params.event The drop event.\n   * @param {Item5e} params.item The target item.\n   * @param {MagicItem} params.magicItem The relevant magic item associated with the target item.\n   * @returns\n   */\n  static async onDrop({ event, item, magicItem }) {\n    event.preventDefault();\n\n    let data;\n    try {\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n      if (!magicItem.support(data.type)) {\n        return;\n      }\n    } catch (err) {\n      return false;\n    }\n\n    const entity = await fromUuid(data.uuid);\n    const pack = entity.pack ? entity.pack : \"world\";\n\n    if (entity && magicItem.compatible(entity)) {\n      magicItem.addEntity(entity, pack);\n      await item.update({\n        flags: {\n          [CONSTANTS.MODULE_ID]: magicItem.serializeData(),\n        },\n      });\n    }\n  }\n\n  /**\n   * Activates listeners related to tab contents.\n   *\n   * @param {object}    params The parameters for wiring up tab content event handling.\n   * @param {jQuery}    params.html The sheet HTML jQuery element\n   * @param {Item5e}    params.item The item which is to be changed.\n   * @param {MagicItem} params.magicItem A Magic Item instance\n   * @param {Function}  params.onItemUpdatingCallback A callback for handling when item updates are about to be applied. This is useful for current tab management.\n   */\n  static async activateTabContentsListeners({\n    html,\n    item,\n    magicItem,\n    onItemUpdatingCallback: onMagicItemUpdatingCallback = null,\n  }) {\n    html.find(\".item-delete.item-spell\").click((evt) => {\n      magicItem.removeSpell(evt.target.getAttribute(\"data-spell-idx\"));\n      onMagicItemUpdatingCallback?.();\n      item.update({\n        flags: {\n          [CONSTANTS.MODULE_ID]: magicItem.serializeData(),\n        },\n      });\n    });\n    html.find(\".item-delete.item-feat\").click((evt) => {\n      magicItem.removeFeat(evt.target.getAttribute(\"data-feat-idx\"));\n      onMagicItemUpdatingCallback?.();\n      item.update({\n        flags: {\n          [CONSTANTS.MODULE_ID]: magicItem.serializeData(),\n        },\n      });\n    });\n    html.find(\".item-delete.item-table\").click((evt) => {\n      magicItem.removeTable(evt.target.getAttribute(\"data-table-idx\"));\n      onMagicItemUpdatingCallback?.();\n      item.update({\n        flags: {\n          [CONSTANTS.MODULE_ID]: magicItem.serializeData(),\n        },\n      });\n    });\n\n    html.find(\"input[name='flags.magicitems.internal']\").click(async (evt) => {\n      await magicItem.updateInternalCharges(evt.target.checked, item);\n      onMagicItemUpdatingCallback?.();\n      item.update({\n        flags: {\n          [CONSTANTS.MODULE_ID]: magicItem.serializeData(),\n        },\n      });\n    });\n\n    magicItem.spells.forEach((spell, idx) => {\n      html.find(`a[data-spell-idx=\"${idx}\"]`).click((evt) => {\n        spell.renderSheet();\n      });\n    });\n    magicItem.feats.forEach((feat, idx) => {\n      html.find(`a[data-feat-idx=\"${idx}\"]`).click((evt) => {\n        feat.renderSheet();\n      });\n    });\n    magicItem.tables.forEach((table, idx) => {\n      html.find(`a[data-table-idx=\"${idx}\"]`).click((evt) => {\n        table.renderSheet();\n      });\n    });\n  }\n\n  static get acceptedItemTypes() {\n    return [\"weapon\", \"equipment\", \"consumable\", \"tool\", \"backpack\", \"feat\"];\n  }\n\n  static isAcceptedItemType(document) {\n    return MagicItemTab.acceptedItemTypes.includes(document?.type);\n  }\n\n  static isAllowedToShow() {\n    return game.user.isGM || !game.settings.get(CONSTANTS.MODULE_ID, \"hideFromPlayers\");\n  }\n}\n","import CONSTANTS from \"../constants/constants\";\nimport Logger from \"../lib/Logger\";\nimport { RetrieveHelpers } from \"../lib/retrieve-helpers\";\n\nexport class AbstractOwnedMagicItemEntry {\n  constructor(magicItem, item) {\n    this.magicItem = magicItem;\n    this.item = item;\n    this.uses = parseInt(\"uses\" in this.item ? this.item.uses : this.magicItem.charges);\n\n    // Patch retrocompatbility\n    if (this.item.pack?.startsWith(\"magic-items\")) {\n      this.item.pack = this.item.pack.replace(\"magic-items-2.\", `${CONSTANTS.MODULE_ID}.`);\n    }\n    // Generate Uuid runtime\n    if (!this.item.uuid) {\n      try {\n        this.item.uuid = RetrieveHelpers.retrieveUuid({\n          documentName: this.item.name,\n          documentId: this.item.id,\n          documentCollectionType: this.item.collectionType,\n          documentPack: this.item.pack,\n          ignoreError: true,\n        });\n      } catch (e) {\n        Logger.error(\"Cannot retrieve uuid\", false, e);\n        this.item.uuid = \"\";\n      }\n    }\n    this.item.removed = !RetrieveHelpers.stringIsUuid(this.item.uuid);\n  }\n\n  get uuid() {\n    return this.item.uuid;\n  }\n\n  get id() {\n    return this.item.id;\n  }\n\n  get name() {\n    return this.item.name;\n  }\n\n  get img() {\n    return this.item.img;\n  }\n\n  get uses() {\n    return this.item.uses;\n  }\n\n  get destroyDC() {\n    return this.item.destroyDC;\n  }\n\n  set uses(uses) {\n    this.item.uses = uses;\n  }\n\n  isFull() {\n    return this.uses === this.magicItem.charges;\n  }\n\n  hasCharges(consumption) {\n    let uses = this.magicItem.chargesOnWholeItem ? this.magicItem.uses : this.uses;\n    return uses - consumption >= 0;\n  }\n\n  async consume(consumption) {\n    if (this.magicItem.chargesOnWholeItem) {\n      await this.magicItem.consume(consumption);\n    } else {\n      this.uses = Math.max(this.uses - consumption, 0);\n      if (await this.destroyed()) {\n        this.magicItem.destroyItemEntry(this.item);\n      } else {\n        this.showLeftChargesMessage();\n      }\n    }\n  }\n\n  async destroyed() {\n    let destroyed = this.uses === 0 && this.magicItem.destroy;\n    if (destroyed && this.magicItem.destroyCheck === \"d2\") {\n      let r = new Roll(\"1d20\");\n      await r.evaluate();\n      destroyed = r.total === 1;\n      await r.toMessage({\n        flavor: `<b>${this.name}</b> ${game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheck\")}\n            - ${\n              destroyed\n                ? game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheckFailure\")\n                : game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheckSuccess\")\n            }`,\n        speaker: ChatMessage.getSpeaker({ actor: this.magicItem.actor, token: this.magicItem.actor.token }),\n      });\n    } else if (destroyed && this.magicItem.destroyCheck === \"d3\") {\n      let r = new Roll(\"1d20\");\n      await r.evaluate();\n      destroyed = r.total <= this.destroyDC;\n      await r.toMessage({\n        flavor: `<b>${this.name}</b> ${game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheck\")}\n                        - ${\n                          destroyed\n                            ? game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheckFailure\")\n                            : game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheckSuccess\")\n                        }`,\n        speaker: ChatMessage.getSpeaker({ actor: this.actor, token: this.actor.token }),\n      });\n    }\n    if (destroyed) {\n      ChatMessage.create({\n        user: game.user._id,\n        speaker: ChatMessage.getSpeaker({ actor: this.magicItem.actor }),\n        content: this.magicItem.formatMessage(`<b>${this.name}</b> ${this.magicItem.destroyFlavorText}`),\n      });\n    }\n    return destroyed;\n  }\n\n  showNoChargesMessage(callback) {\n    const message = game.i18n.localize(\"MAGICITEMS.SheetNoChargesMessage\");\n    const title = game.i18n.localize(\"MAGICITEMS.SheetDialogTitle\");\n    let d = new Dialog({\n      title: title,\n      content: `<b>'${this.magicItem.name}'</b> - ${message} <b>'${this.item.name}'</b><br><br>`,\n      buttons: {\n        use: {\n          icon: '<i class=\"fas fa-check\"></i>',\n          label: game.i18n.localize(\"MAGICITEMS.SheetDialogUseAnyway\"),\n          callback: () => callback(),\n        },\n        close: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n.localize(\"MAGICITEMS.SheetDialogClose\"),\n          callback: () => d.close(),\n        },\n      },\n      default: \"close\",\n    });\n    d.render(true);\n  }\n\n  activeEffectMessage(callback) {\n    const message = game.i18n.localize(\"MAGICITEMS.ToggleActiveEffectDialogMessage\");\n    const title = game.i18n.localize(\"MAGICITEMS.ToggleActiveEffectDialogTitle\");\n    let x = new Dialog({\n      title: title,\n      content: `${message}<br><br>`,\n      buttons: {\n        use: {\n          icon: '<i class=\"fas fa-check\"></i>',\n          label: game.i18n.localize(\"MAGICITEMS.ToggleActiveEffectDialogYes\"),\n          callback: () => callback(),\n        },\n        close: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n.localize(\"MAGICITEMS.ToggleActiveEffectDialogNo\"),\n          callback: () => x.close(),\n        },\n      },\n      default: \"use\",\n    });\n    x.render(true);\n  }\n\n  async askSummonningMessage(summonOptions) {\n    let html = await renderTemplate(\n      `modules/${CONSTANTS.MODULE_ID}/templates/magic-item-summon-dialog.hbs`,\n      summonOptions,\n    );\n    let dialog = await foundry.applications.api.DialogV2.prompt({\n      window: {\n        title: game.i18n.localize(\"MAGICITEMS.SummoningDialogTitle\"),\n      },\n      content: html,\n      modal: true,\n      rejectClose: false,\n      ok: {\n        label: game.i18n.localize(\"MAGICITEMS.SummoningDialogButton\"),\n        icon: \"fas fa-wand-magic-sparkles\",\n        callback: (event, button, dialog) => button.form.elements,\n      },\n    });\n    return dialog;\n  }\n\n  computeSaveDC(item) {\n    const data = this.magicItem.actor.system;\n    data.attributes.spelldc = data.attributes.spellcasting ? data.abilities[data.attributes.spellcasting].dc : 10;\n\n    const save = item.system.save;\n    if (save?.ability) {\n      if (save.scaling === \"spell\") save.dc = data.attributes.spelldc;\n      else if (save.scaling !== \"flat\") save.dc = data.abilities[save.scaling]?.dc ?? 10;\n      const ability = CONFIG.DND5E.abilities[save.ability];\n      item.labels.save = game.i18n.format(\"DND5E.SaveDC\", { dc: save.dc || \"\", ability });\n    }\n  }\n\n  async applyActiveEffects(item) {\n    canvas.tokens.controlled?.forEach((token) => {\n      if (!token) {\n        Logger.warn(\"No token selected\", true);\n        return;\n      }\n      let actor = token.actor;\n\n      item?.effects.toObject()?.forEach(async (effect) => {\n        if (!game.user.isGM && !actor?.isOwner) {\n          return;\n        }\n        const existingEffect = actor?.effects?.find((e) => e.origin === item.uuid);\n        if (existingEffect) {\n          existingEffect.update({ disabled: !existingEffect.disabled });\n          return;\n        }\n        effect = foundry.utils.mergeObject(effect, {\n          disabled: false,\n          transfer: false,\n          origin: item.uuid,\n        });\n        const ae = await ActiveEffect.implementation.create(effect, { parent: actor });\n        if (!ae) {\n          Logger.warn(game.i18n.localize(\"MAGICITEMS.ToggleActiveEffectError\"), true);\n        }\n      });\n    });\n  }\n\n  showLeftChargesMessage() {\n    if (game.settings.get(CONSTANTS.MODULE_ID, \"showLeftChargesChatMessage\")) {\n      const charges = this.magicItem.chargesOnWholeItem ? this.magicItem.uses : this.uses;\n      const maxCharges = parseInt(\"uses\" in this.item ? this.item.uses : this.magicItem.charges);\n      Logger.debug(`Charges: ${charges}, MaxCharges: ${maxCharges}`);\n      if (charges !== 0) {\n        ChatMessage.create({\n          user: game.user_id,\n          speaker: ChatMessage.getSpeaker({ actor: this.magicItem.actor, token: this.magicItem.actor.token }),\n          content: game.i18n.format(game.i18n.localize(\"MAGICITEMS.ShowChargesMessage\"), {\n            name: this.magicItem.name,\n            chargesLeft: charges,\n            chargesMax: maxCharges,\n          }),\n        });\n      }\n    }\n  }\n}\n","import { AbstractOwnedMagicItemEntry } from \"./AbstractOwnedMagicItemEntry\";\nimport { MagicItemHelpers } from \"../magic-item-helpers\";\n\nexport class OwnedMagicItemFeat extends AbstractOwnedMagicItemEntry {\n  async roll() {\n    let consumption = this.item.consumption;\n\n    if (!this.ownedItem) {\n      let data = await this.item.data();\n\n      data = foundry.utils.mergeObject(data, {\n        \"system.uses\": null,\n      });\n\n      data = foundry.utils.mergeObject(data, {\n        \"flags.core\": {\n          sourceId: this.item.uuid,\n        },\n      });\n\n      const cls = CONFIG.Item.documentClass;\n      this.ownedItem = new cls(data, { parent: this.magicItem.actor });\n      this.ownedItem.prepareFinalAttributes();\n    }\n\n    let onUsage =\n      this.item.effect === \"e1\"\n        ? async () => {\n            await this.consume(consumption);\n          }\n        : async () => {\n            ChatMessage.create({\n              user: game.user._id,\n              speaker: ChatMessage.getSpeaker({ actor: this.magicItem.actor }),\n              content: this.magicItem.formatMessage(\n                `<b>${this.name}</b>: ${game.i18n.localize(\"MAGICITEMS.SheetConsumptionDestroyMessage\")}`,\n              ),\n            });\n\n            await this.magicItem.destroyItem();\n          };\n\n    let proceed = async () => {\n      let feat = this.ownedItem;\n      if (feat.effects?.size > 0 && !MagicItemHelpers.isMidiItemEffectWorkflowOn()) {\n        feat = feat.clone({ effects: {} }, { keepId: true });\n        feat.prepareFinalAttributes();\n      }\n      let chatData = await feat.use(\n        {},\n        {\n          createMessage: true,\n          configureDialog: false,\n          flags: {\n            \"dnd5e.itemData\": this.ownedItem.toJSON(),\n          },\n        },\n      );\n      if (chatData) {\n        await onUsage();\n        if (!this.magicItem.isDestroyed) {\n          this.magicItem.update();\n        }\n      }\n      if (this.ownedItem.effects?.size > 0 && !MagicItemHelpers.isMidiItemEffectWorkflowOn()) {\n        this.activeEffectMessage(async () => {\n          await this.applyActiveEffects(this.ownedItem);\n        });\n      }\n    };\n\n    if (this.item.effect === \"e2\" || this.hasCharges(consumption)) {\n      await proceed();\n    } else {\n      this.showNoChargesMessage(() => {\n        proceed();\n      });\n    }\n  }\n}\n","import CONSTANTS from \"./constants/constants\";\n\n/**\n * A specialized Dialog subclass for casting a spell item at a certain level\n * @type {Dialog}\n */\nexport class MagicItemUpcastDialog extends Dialog {\n  constructor(item, dialogData = {}, options = {}) {\n    super(dialogData, options);\n    this.options.classes = [\"dnd5e\", \"dialog\"];\n    this.item = item;\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find(`select[name=\"level\"]`).change((evt) => {\n      let level = parseInt(evt.target.value);\n      let consumption = this.item.consumptionAt(level);\n      html.find(`input[name=\"consumption\"]`).val(consumption);\n    });\n  }\n\n  static async create(magicItem, item) {\n    const html = await renderTemplate(`modules/${CONSTANTS.MODULE_ID}/templates/magic-item-upcast-dialog.html`, item);\n\n    // Create the Dialog and return as a Promise\n    return new Promise((resolve, reject) => {\n      const dlg = new this(item, {\n        title: `${magicItem.name} > ${item.name}: Spell Configuration`,\n        content: html,\n        buttons: {\n          cast: {\n            icon: '<i class=\"fas fa-magic\"></i>',\n            label: \"Cast\",\n            callback: (html) => resolve(new FormData(html[0].querySelector(\"#spell-config-form\"))),\n          },\n        },\n        default: \"cast\",\n        close: reject,\n      });\n      dlg.render(true);\n    });\n  }\n}\n","import Logger from \"../lib/Logger\";\nimport { MagicItemUpcastDialog } from \"../magicitemupcastdialog\";\nimport { AbstractOwnedMagicItemEntry } from \"./AbstractOwnedMagicItemEntry\";\nimport { MagicItemHelpers } from \"../magic-item-helpers\";\nimport { RetrieveHelpers } from \"../lib/retrieve-helpers\";\n\nexport class OwnedMagicItemSpell extends AbstractOwnedMagicItemEntry {\n  async roll() {\n    let upcastLevel = this.item.level;\n    let consumption = this.item.consumption;\n\n    if (!this.ownedItem) {\n      let data = await this.item.data();\n\n      if (typeof data.system.save.scaling === \"undefined\") {\n        data = foundry.utils.mergeObject(data, {\n          \"system.save.scaling\": \"spell\",\n        });\n      }\n\n      if (this.item.flatDc) {\n        data = foundry.utils.mergeObject(data, {\n          \"system.save.scaling\": \"flat\",\n          \"system.save.dc\": this.item.dc,\n        });\n      }\n\n      if (data.system.actionType === \"rsak\" || data.system.actionType === \"msak\") {\n        let attackBonusValue = this.item.atkBonus.toString();\n        if (!this.item.checkAtkBonus) {\n          attackBonusValue = this.magicItem.actor?.system?.attributes?.prof?.toString();\n        }\n        if (data.system.attack.bonus) {\n          data.system.attack.bonus += `+ ${attackBonusValue}`;\n        } else {\n          data.system.attack.bonus = attackBonusValue;\n        }\n      }\n\n      data = foundry.utils.mergeObject(data, {\n        \"system.preparation\": { mode: \"magicitems\" },\n      });\n\n      data = foundry.utils.mergeObject(data, {\n        \"flags.core\": {\n          sourceId: this.item.uuid,\n        },\n      });\n\n      const cls = CONFIG.Item.documentClass;\n      this.ownedItem = new cls(data, { parent: this.magicItem.actor });\n      this.ownedItem.prepareFinalAttributes();\n    }\n\n    if (this.item.canUpcast()) {\n      const spellFormData = await MagicItemUpcastDialog.create(this.magicItem, this.item);\n      upcastLevel = parseInt(spellFormData.get(\"level\"));\n      consumption = parseInt(spellFormData.get(\"consumption\"));\n    }\n\n    let proceed = async () => {\n      let spell = this.ownedItem;\n      let clonedOwnedItem = this.ownedItem;\n      let itemUseConfiguration = {};\n\n      if (\n        MagicItemHelpers.canSummon() &&\n        (spell.system.summons?.creatureTypes?.length > 1 || spell.system.summons?.profiles?.length > 1)\n      ) {\n        const sOptions = MagicItemHelpers.createSummoningOptions(spell);\n        const summoningDialogResult = await this.askSummonningMessage(sOptions);\n        if (summoningDialogResult) {\n          foundry.utils.mergeObject(itemUseConfiguration, {\n            createSummons: summoningDialogResult.createSummons?.value === \"on\",\n            summonsProfile: summoningDialogResult.summonsProfile?.value,\n            summonsOptions: {\n              creatureType: summoningDialogResult.creatureType?.value,\n              creatureSize: summoningDialogResult.creatureSize?.value,\n            },\n          });\n        } else {\n          Logger.info(`The summoning dialog has been dismissed, not using the item.`);\n          return;\n        }\n      }\n\n      if (spell.system.level === 0 && !MagicItemHelpers.isLevelScalingSettingOn()) {\n        spell = spell.clone({ \"system.scaling\": \"none\" }, { keepId: true });\n        clonedOwnedItem = clonedOwnedItem.clone({ \"system.scaling\": \"none\" }, { keepId: true });\n        spell.prepareFinalAttributes();\n      }\n\n      if (upcastLevel !== spell.system.level) {\n        foundry.utils.mergeObject(itemUseConfiguration, {\n          slotLevel: upcastLevel,\n        });\n      }\n\n      if (spell.effects?.size > 0 && !MagicItemHelpers.isMidiItemEffectWorkflowOn()) {\n        spell = spell.clone({ effects: {} }, { keepId: true });\n        spell.prepareFinalAttributes();\n      }\n\n      let chatData = await spell.use(itemUseConfiguration, {\n        configureDialog: false,\n        createMessage: true,\n        flags: {\n          \"dnd5e.itemData\": clonedOwnedItem,\n        },\n      });\n      if (chatData) {\n        await this.consume(consumption);\n        if (!this.magicItem.isDestroyed) {\n          this.magicItem.update();\n        }\n      }\n      if (this.ownedItem.effects?.size > 0 && !MagicItemHelpers.isMidiItemEffectWorkflowOn()) {\n        this.activeEffectMessage(async () => {\n          await this.applyActiveEffects(this.ownedItem);\n        });\n      }\n    };\n\n    if (this.hasCharges(consumption)) {\n      await proceed();\n    } else {\n      this.showNoChargesMessage(async () => {\n        await proceed();\n      });\n    }\n  }\n}\n","import { AbstractOwnedMagicItemEntry } from \"./AbstractOwnedMagicItemEntry\";\n\nexport class OwnedMagicItemTable extends AbstractOwnedMagicItemEntry {\n  async roll() {\n    let item = this.item;\n    let consumption = item.consumption;\n    if (this.hasCharges(consumption)) {\n      await item.roll(this.magicItem.actor);\n      await this.consume(consumption);\n    } else {\n      this.showNoChargesMessage(() => {\n        item.roll(this.magicItem.actor);\n      });\n    }\n  }\n}\n","import { MAGICITEMS } from \"../config\";\nimport CONSTANTS from \"../constants/constants\";\nimport Logger from \"../lib/Logger\";\nimport { RetrieveHelpers } from \"../lib/retrieve-helpers\";\nimport { MagicItemHelpers } from \"../magic-item-helpers\";\nimport { OwnedMagicItemFeat } from \"../magic-item-owned-entry/OwnedMagicItemFeat\";\nimport { OwnedMagicItemSpell } from \"../magic-item-owned-entry/OwnedMagicItemSpell\";\nimport { OwnedMagicItemTable } from \"../magic-item-owned-entry/OwnedMagicItemTable\";\nimport { MagicItem } from \"./MagicItem\";\n\nexport class OwnedMagicItem extends MagicItem {\n  constructor(item, actor, magicItemActor, flagsData) {\n    super(flagsData);\n    this.uuid = item.uuid;\n    this.id = item.id;\n    this.item = item;\n    this.actor = actor;\n    this.name = item.name;\n    this.img = item.img;\n    this.pack = item.pack;\n    this.isDestroyed = false;\n    this.uses = parseInt(\"uses\" in flagsData ? flagsData.uses : this.charges);\n\n    this.rechargeableLabel = this.rechargeable\n      ? `(${game.i18n.localize(\"MAGICITEMS.SheetRecharge\")}: ${this.rechargeText} ${\n          MagicItemHelpers.localized(MAGICITEMS.rechargeUnits)[this.rechargeUnit]\n        } )`\n      : game.i18n.localize(\"MAGICITEMS.SheetNoRecharge\");\n\n    this.magicItemActor = magicItemActor;\n\n    this.ownedEntries = this.spells.map((item) => new OwnedMagicItemSpell(this, item));\n    this.ownedEntries = this.ownedEntries.concat(this.feats.map((item) => new OwnedMagicItemFeat(this, item)));\n    this.ownedEntries = this.ownedEntries.concat(this.tables.map((table) => new OwnedMagicItemTable(this, table)));\n\n    this.instrument();\n  }\n\n  /**\n   *\n   */\n  instrument() {\n    this.item.roll = this.itemRoll(this.item.roll, this);\n  }\n\n  /**\n   * Tests if the owned magic items can visualize his powers.\n   */\n  get visible() {\n    let identifiedOnly = game.settings.get(CONSTANTS.MODULE_ID, \"identifiedOnly\");\n    return this.item?.type === \"feat\" || !identifiedOnly || this.item.system.identified;\n  }\n\n  /**\n   * Tests if the owned magic items is active.\n   */\n  get active() {\n    let active = true;\n    if (this.equipped) {\n      active = active && this.item.system.equipped;\n    }\n    if (this.attuned) {\n      let isAttuned =\n        this.item.system.attunement === 2 ||\n        this.item.system.attuned === true; /* this.item.system.attuned is a legacy property; can be undefined */\n      active = active && isAttuned;\n    }\n    return active;\n  }\n\n  itemRoll(original, me) {\n    return async function () {\n      me.triggerTables();\n      return await original.apply(me.item, arguments);\n    };\n  }\n\n  isFull() {\n    return this.uses === this.charges;\n  }\n\n  setUses(uses) {\n    this.uses = uses;\n  }\n\n  async roll(itemId) {\n    let ownedItem = this.ownedEntries.filter((entry) => entry.id === itemId)[0];\n    await ownedItem.roll();\n  }\n\n  rollByName(itemName) {\n    let found = this.ownedEntries.filter((entry) => entry.name === itemName);\n    if (!found.length) {\n      Logger.warn(game.i18n.localize(\"MAGICITEMS.WarnNoMagicItemSpell\") + itemName, true);\n      return;\n    }\n    found[0].roll();\n  }\n\n  async destroyItem() {\n    await this.magicItemActor.destroyItem(this);\n  }\n\n  async consume(consumption) {\n    if (this.item.system.uses.value) {\n      const usage = Math.max(this.item.system.uses.value - consumption, 0);\n      var embeddedDocument = await RetrieveHelpers.getItemAsync(this.item);\n      embeddedDocument.update({\n        [CONSTANTS.CURRENT_CHARGES_PATH]: usage,\n      });\n      this.uses = usage;\n    } else if (this.uses) {\n      if (!this.item.system.uses.autoDestroy) {\n        if (await this.destroyed()) {\n          if (this.destroyType === MAGICITEMS.DESTROY_JUST_DESTROY) {\n            this.isDestroyed = true;\n            await this.destroyItem();\n          } else {\n            this.toggleEnabled(false);\n          }\n        }\n      }\n    }\n  }\n\n  async destroyed() {\n    let destroyed = this.uses === 0 && this.destroy;\n    if (destroyed && this.destroyCheck === \"d2\") {\n      let r = new Roll(\"1d20\");\n      await r.evaluate();\n      destroyed = r.total === 1;\n      await r.toMessage({\n        flavor: `<b>${this.name}</b> ${game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheck\")}\n                        - ${\n                          destroyed\n                            ? game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheckFailure\")\n                            : game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheckSuccess\")\n                        }`,\n        speaker: ChatMessage.getSpeaker({ actor: this.actor, token: this.actor.token }),\n      });\n    } else if (destroyed && this.destroyCheck === \"d3\") {\n      let r = new Roll(\"1d20\");\n      await r.evaluate();\n      destroyed = r.total <= this.destroyDC;\n      await r.toMessage({\n        flavor: `<b>${this.name}</b> ${game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheck\")}\n                        - ${\n                          destroyed\n                            ? game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheckFailure\")\n                            : game.i18n.localize(\"MAGICITEMS.MagicItemDestroyCheckSuccess\")\n                        }`,\n        speaker: ChatMessage.getSpeaker({ actor: this.actor, token: this.actor.token }),\n      });\n    }\n    if (destroyed) {\n      ChatMessage.create({\n        user: game.user._id,\n        speaker: ChatMessage.getSpeaker({ actor: this.actor }),\n        content: this.formatMessage(`<b>${this.name}</b> ${this.destroyFlavorText}`),\n      });\n    }\n    return destroyed;\n  }\n\n  async onShortRest() {\n    if ((this.rechargeable && this.rechargeUnit === MAGICITEMS.SHORT_REST) || this.internal) {\n      return await this.doRecharge();\n    }\n  }\n\n  async onLongRest() {\n    if (\n      (this.rechargeable && [MAGICITEMS.LONG_REST, MAGICITEMS.SHORT_REST].includes(this.rechargeUnit)) ||\n      this.internal\n    ) {\n      return await this.doRecharge();\n    }\n  }\n\n  async onNewDay() {\n    if (\n      (this.rechargeable && [MAGICITEMS.DAILY, MAGICITEMS.DAWN, MAGICITEMS.SUNSET].includes(this.rechargeUnit)) ||\n      this.internal\n    ) {\n      return await this.doRecharge();\n    }\n  }\n\n  async doRecharge() {\n    let amount = 0,\n      updated = 0,\n      msg = `<b>Magic Item:</b> ${this.rechargeableLabel}<br>`;\n\n    let prefix = game.i18n.localize(\"MAGICITEMS.SheetRechargedBy\");\n    let postfix = game.i18n.localize(\"MAGICITEMS.SheetChargesLabel\");\n    if (!this.internal) {\n      if (this.rechargeType === MAGICITEMS.NUMERIC_RECHARGE) {\n        amount = parseInt(this.recharge);\n        msg += `<b>${prefix}</b>: ${this.recharge} ${postfix}`;\n      }\n      if (this.rechargeType === MAGICITEMS.FORMULA_RECHARGE) {\n        let r = new Roll(this.recharge);\n        await r.evaluate();\n        amount = r.total;\n        msg += `<b>${prefix}</b>: ${r.result} = ${r.total} ${postfix}`;\n      }\n      if (this.rechargeType === MAGICITEMS.FORMULA_FULL) {\n        msg += `<b>${game.i18n.localize(\"MAGICITEMS.RechargeTypeFullText\")}</b>`;\n      }\n\n      if (this.chargesOnWholeItem) {\n        if (this.isFull()) {\n          return;\n        }\n\n        if (this.rechargeType === MAGICITEMS.FORMULA_FULL) {\n          updated = this.charges;\n        } else {\n          updated = Math.min(this.uses + amount, parseInt(this.charges));\n        }\n\n        this.setUses(updated);\n      } else {\n        if (this.ownedEntries.filter((entry) => !entry.isFull()).length === 0) {\n          return;\n        }\n\n        this.ownedEntries.forEach((entry) => {\n          if (this.rechargeType === MAGICITEMS.FORMULA_FULL) {\n            entry.uses = this.charges;\n          } else {\n            entry.uses = Math.min(entry.uses + amount, parseInt(this.charges));\n          }\n        });\n      }\n      ChatMessage.create({\n        speaker: { actor: this.actor },\n        type: CONST.CHAT_MESSAGE_TYPES.OTHER,\n        content: this.formatMessage(msg),\n      });\n    } else {\n      this.setUses(this.item.system.uses.value);\n    }\n\n    this.update();\n  }\n\n  entryBy(itemId) {\n    return this.ownedEntries.filter((entry) => entry.id === itemId)[0];\n  }\n\n  ownedItemBy(itemId) {\n    return this.entryBy(itemId).ownedItem;\n  }\n\n  triggerTables() {\n    this.triggeredTables.forEach((table) => table.roll());\n  }\n\n  destroyItemEntry(entry) {\n    if (this.hasSpell(entry.id)) {\n      this.removeSpell(this.spells.findIndex((spell) => spell.id === entry.id));\n    }\n  }\n\n  update() {\n    this.magicItemActor.suspendListening();\n    this.item\n      .update({\n        flags: {\n          [CONSTANTS.MODULE_ID]: this.serializeData(),\n        },\n      })\n      .then(() => {\n        this.magicItemActor.resumeListening();\n      });\n  }\n\n  getRechargeableLabel() {\n    return `(${game.i18n.localize(\"MAGICITEMS.SheetRecharge\")}: ${this.rechargeText} ${\n      MagicItemHelpers.localized(MAGICITEMS.rechargeUnits)[this.rechargeUnit]\n    } )`;\n  }\n\n  formatMessage(msg) {\n    return `\n            <div class=\"dnd5e chat-card item-card\">\n                <header class=\"card-header flexrow\">\n                    <img src=\"${this.img}\" title=\"Palla di Fuoco\" width=\"36\" height=\"36\" />\n                    <h3 class=\"item-name\">${this.name}</h3>\n                </header>\n\n                <div class=\"card-content\">${msg}</div>\n            </div>`;\n  }\n}\n","import { MAGICITEMS } from \"./config.js\";\nimport CONSTANTS from \"./constants/constants.js\";\nimport Logger from \"./lib/Logger.js\";\nimport { RetrieveHelpers } from \"./lib/retrieve-helpers.js\";\nimport { MagicItemHelpers } from \"./magic-item-helpers.js\";\nimport { OwnedMagicItem } from \"./magic-item/OwnedMagicItem.js\";\n\n/**\n * \"Aspect\" class that dynamically extends the original Actor in order to handle magic items.\n */\nexport class MagicItemActor {\n  /**\n   * Create and register a new MagicItemActor.\n   *\n   * @param actor\n   */\n  static bind(actor) {\n    MAGICITEMS.actors[actor.id] = new MagicItemActor(actor);\n  }\n\n  /**\n   * Get a registered MagicItemActor.\n   *\n   * @param actorId   id of the original actor.\n   * @returns {*}     the MagicItemActor associated with the actor by actorId.\n   */\n  static get(actorId) {\n    return MAGICITEMS.actors[actorId];\n  }\n\n  /**\n   * ctor. Builds a new instance of a MagicItemActor\n   *\n   * @param actor\n   */\n  constructor(actor) {\n    this.actor = actor;\n    this.id = actor.id;\n    this.listeners = [];\n    this.destroyed = [];\n    this.listening = true;\n    this.instrument();\n    this.buildItems();\n  }\n\n  /**\n   * Add change listeners.\n   *\n   * @param listener\n   */\n  onChange(listener) {\n    this.listeners.push(listener);\n  }\n\n  /**\n   * Notify listeners of changes.\n   */\n  async fireChange() {\n    this.listeners.forEach(async (listener) => listener());\n  }\n\n  /**\n   * Apply the aspects on the necessary actor pointcuts.\n   */\n  instrument() {\n    this.actor.getOwnedItem = this.getOwnedItem(this.actor.getOwnedItem, this);\n    this.actor.shortRest = this.shortRest(this.actor.shortRest, this);\n    this.actor.longRest = this.longRest(this.actor.longRest, this);\n  }\n\n  /**\n   *\n   * @param original\n   * @param me\n   * @returns {function(*=): *}\n   */\n  getOwnedItem(original, me) {\n    return function (id) {\n      let found = null;\n      me.items.concat(me.destroyed).forEach((item) => {\n        if (item.hasSpell(id) || item.hasFeat(id)) {\n          found = item.ownedItemBy(id);\n        }\n      });\n      return found ? found : original.apply(me.actor, arguments);\n    };\n  }\n\n  /**\n   *\n   * @param original\n   * @param me\n   * @returns {function(): *}\n   */\n  shortRest(original, me) {\n    return async function () {\n      let result = await original.apply(me.actor, arguments);\n      await me.onShortRest(result);\n      return result;\n    };\n  }\n\n  /**\n   *\n   * @param original\n   * @param me\n   * @returns {function(): *}\n   */\n  longRest(original, me) {\n    return async function () {\n      let result = await original.apply(me.actor, arguments);\n      await me.onLongRest(result);\n      return result;\n    };\n  }\n\n  /**\n   * Temporarily suspends the interception of events, used for example to avoid intercepting a change\n   * made by the client itself.\n   */\n  suspendListening() {\n    this.listening = false;\n  }\n\n  /**\n   * Resume a temporarily suspended interception of events.\n   */\n  resumeListening() {\n    this.listening = true;\n  }\n\n  /**\n   * Build the list of magic items based on custom flag data of the item entity.\n   */\n  async buildItems() {\n    this.items = this.actor.items\n      .filter((item) => {\n        const flagsData = foundry.utils.getProperty(item, `flags.${CONSTANTS.MODULE_ID}`);\n        return typeof flagsData !== \"undefined\" && flagsData.enabled;\n      })\n      .map((item) => {\n        const flagsData = foundry.utils.getProperty(item, `flags.${CONSTANTS.MODULE_ID}`);\n        return new OwnedMagicItem(item, this.actor, this, flagsData);\n      });\n    await this.fireChange();\n  }\n\n  /**\n   * Aspect: called after short rest.\n   * Notify the item and update item uses on the actor flags if recharged.\n   *\n   * @param result\n   */\n  async onShortRest(result) {\n    if (result) {\n      this.items.forEach(async (item) => {\n        await item.onShortRest();\n        if (result.newDay) item.onNewDay();\n      });\n      this.fireChange();\n    }\n  }\n\n  /**\n   * Aspect: called after long rest.\n   * Notify the item and update item uses on the actor flags if recharged.\n   *\n   * @param result\n   */\n  async onLongRest(result) {\n    if (result) {\n      this.items.forEach(async (item) => {\n        await item.onLongRest();\n        if (result.newDay) item.onNewDay();\n      });\n      this.fireChange();\n    }\n  }\n\n  /**\n   *\n   * @returns {*}\n   */\n  get visibleItems() {\n    return this.items.filter((item) => item.visible);\n  }\n\n  /**\n   *\n   */\n  get isUsingNew5eSheet() {\n    return this.actor?.sheet && MagicItemHelpers.isUsingNew5eSheet(this.actor?.sheet);\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  hasMagicItems() {\n    return this.hasVisibleItems;\n  }\n\n  /**\n   *\n   */\n  get hasVisibleItems() {\n    return this.items.reduce((visible, item) => visible || item.visible, false);\n  }\n\n  /**\n   * Returns the number of visible magic items owned by the actor.\n   */\n  get magicItemsCount() {\n    return this.visibleItems.length;\n  }\n\n  /**\n   * returns the number of visible actives magic items owned by the actor.\n   */\n  get magicItemsActiveCount() {\n    return this.visibleItems.reduce((actives, item) => actives + item.active, 0);\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  hasItemsSpells() {\n    return this.visibleItems.reduce((hasSpells, item) => hasSpells || item.hasSpells, false);\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  hasItemsFeats() {\n    return this.visibleItems.reduce((hasFeats, item) => hasFeats || item.hasFeats, false);\n  }\n\n  /**\n   *\n   * @param itemId\n   * @returns {number}\n   */\n  magicItem(itemId) {\n    let found = this.items.filter((item) => item.id === itemId);\n    if (found.length) {\n      return found[0];\n    }\n  }\n\n  /**\n   *\n   * @param magicItemName\n   * @param itemName\n   */\n  rollByName(magicItemName, itemName) {\n    let found = this.items.filter((item) => item.name === magicItemName);\n    if (!found.length) {\n      Logger.warn(game.i18n.localize(\"MAGICITEMS.WarnNoMagicItem\") + itemName, true);\n      return;\n    }\n    let item = found[0];\n    item.rollByName(itemName);\n  }\n\n  /**\n   *\n   * @param magicItemId\n   * @param itemId\n   */\n  async roll(magicItemId, itemId) {\n    let found = this.items.filter((item) => item.id === magicItemId);\n    if (found.length) {\n      let item = found[0];\n      await item.roll(itemId);\n    }\n  }\n\n  /**\n   *\n   * @param itemId\n   * @param ownedItemId\n   */\n  async renderSheet(itemId, ownedItemId) {\n    let item = this.items.find((item) => {\n      return item.id === itemId || item.uuid === itemId;\n    });\n    if (item) {\n      item.renderSheet(ownedItemId);\n    }\n  }\n\n  /**\n   * Delete the magic item from the owned items of the actor,\n   * keeping a temporary reference in case of open chat sheets.\n   *\n   * @param item\n   */\n  async destroyItem(item) {\n    const magicItemParent = item.item;\n    const currentQuantity = foundry.utils.getProperty(magicItemParent, CONSTANTS.QUANTITY_PROPERTY_PATH) || 1;\n    if (currentQuantity > 1) {\n      const defaultReference = foundry.utils.getProperty(\n        magicItemParent,\n        `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.DEFAULT}`,\n      );\n      let updateItem = {};\n      if (defaultReference) {\n        const defaultItem = await RetrieveHelpers.getItemAsync(defaultReference);\n        const defaultDataFlags = foundry.utils.getProperty(defaultItem, `flags.${CONSTANTS.MODULE_ID}`);\n        defaultDataFlags.default = defaultItem.uuid;\n        updateItem = {\n          _id: magicItemParent.id,\n          [CONSTANTS.QUANTITY_PROPERTY_PATH]: currentQuantity - 1,\n          flags: {\n            [CONSTANTS.MODULE_ID]: defaultDataFlags || {},\n          },\n        };\n      } else {\n        const tmpItem = await RetrieveHelpers.getItemAsync(magicItemParent);\n        const tmpItemFlags = foundry.utils.getProperty(tmpItem, `flags.${CONSTANTS.MODULE_ID}`);\n        updateItem = {\n          _id: tmpItem.id,\n          [CONSTANTS.QUANTITY_PROPERTY_PATH]: currentQuantity - 1,\n          flags: {\n            [CONSTANTS.MODULE_ID]: tmpItemFlags || {},\n          },\n        };\n      }\n      await this.actor.updateEmbeddedDocuments(\"Item\", [updateItem]);\n    } else {\n      let idx = 0;\n      this.items.forEach((owned, i) => {\n        if (owned.id === item.id) {\n          idx = i;\n        }\n      });\n      this.items.splice(idx, 1);\n      this.destroyed.push(item);\n\n      await this.actor.deleteEmbeddedDocuments(\"Item\", [magicItemParent.id]);\n    }\n  }\n}\n","import { MAGICITEMS } from \"./config.js\";\nimport CONSTANTS from \"./constants/constants.js\";\nimport { MagicItemHelpers } from \"./magic-item-helpers.js\";\nimport { RetrieveHelpers } from \"./lib/retrieve-helpers.js\";\nimport { MagicItemActor } from \"./magicitemactor.js\";\nimport Logger from \"./lib/Logger.js\";\n\nconst magicItemSheets = [];\n\nexport class MagicItemSheet {\n  /**\n   * Crete and register an instance of a MagicItemSheet, if not already present,\n   * bindings with the corresponding MagiItemActor and reinitialize with the new rendered html.\n   *\n   * @param app\n   * @param html\n   * @param data\n   */\n  static bind(app, html, data) {\n    if (MagicItemActor.get(app.actor.id)) {\n      let sheet = magicItemSheets[app.id];\n      if (!sheet) {\n        sheet = new MagicItemSheet(app.actor.id);\n        magicItemSheets[app.id] = sheet;\n      }\n      sheet.init(html, data);\n    }\n  }\n\n  /**\n   * Ctor. builds a new MagicItemSheet with the required actorId.\n   *\n   * @param actorId\n   */\n  constructor(actorId) {\n    this.actor = MagicItemActor.get(actorId);\n    this.actor.onChange(() => this.render());\n  }\n\n  /**\n   * Set the rendered html from the original sheet and render if the actor has magic items.\n   *\n   * @param html\n   * @param data\n   */\n  init(html, data) {\n    this.html = html;\n    this.data = data;\n\n    if (this.actor.hasMagicItems()) {\n      this.render();\n    }\n  }\n\n  /**\n   * Render the sheet\n   * @returns {Promise<void>}\n   */\n  async render() {\n    if (!this.actor?.isUsingNew5eSheet) {\n      if (this.actor.hasItemsFeats()) {\n        await this.renderTemplate(\n          \"magic-item-feat-sheet.html\",\n          \"magicitems-feats-content\",\n          \"features\",\n          \"inventory-list\",\n        );\n      }\n      if (this.actor.hasItemsSpells()) {\n        await this.renderTemplate(\n          \"magic-item-spell-sheet.html\",\n          \"magicitems-spells-content\",\n          \"spellbook\",\n          \"inventory-list\",\n        );\n      }\n    } else {\n      if (this.actor.hasItemsFeats()) {\n        await this.renderTemplate(\n          \"magic-item-feat-sheet-v2.hbs\",\n          \"magicitems-feats-content\",\n          \"features\",\n          \"features-list\",\n        );\n        this.html.find(\".item-tooltip\").each((idx, el) => this.addToolTips(el));\n      }\n      if (this.actor.hasItemsSpells()) {\n        await this.renderTemplate(\n          \"magic-item-spell-sheet-v2.hbs\",\n          \"magicitems-spells-content\",\n          \"spells\",\n          \"spells-list\",\n        );\n        this.html.find(\".item-tooltip\").each((idx, el) => this.addToolTips(el));\n      }\n    }\n\n    this.actor.items\n      .filter((item) => item.visible)\n      .forEach((item) => {\n        let itemEl = this.html.find(`.inventory-list .item-list .item[data-item-id=\"${item.id}\"]`);\n        let itemName = this.actor.isUsingNew5eSheet ? itemEl.find(\".name .subtitle\") : itemEl.find(\"h4\");\n        if (!itemName.find(\"i.fa-magic\").length) {\n          itemName.append(CONSTANTS.HTML.MAGIC_ITEM_ICON);\n        }\n      });\n\n    MagicItemSheet.handleEvents(this.html, this.actor);\n  }\n\n  /**\n   * Utility functions, render or replace the template by name in the passed tab.\n   *\n   * @param filename\n   * @param cls\n   * @param tab\n   * @returns {Promise<void>}\n   */\n  async renderTemplate(filename, cls, tab, listName) {\n    let template = await renderTemplate(`modules/${CONSTANTS.MODULE_ID}/templates/${filename}`, this.actor);\n    let el = this.html.find(`.${cls}`);\n    if (el.length) {\n      el.replaceWith(template);\n    } else {\n      if (game.settings.get(CONSTANTS.MODULE_ID, \"optionDisplayMainSheetItems\") === CONSTANTS.DISPLAY_OPTIONS.BOTTOM) {\n        this.html.find(`.${tab} .${listName}`).append(template);\n      } else if (\n        game.settings.get(CONSTANTS.MODULE_ID, \"optionDisplayMainSheetItems\") === CONSTANTS.DISPLAY_OPTIONS.TOP\n      ) {\n        this.html.find(`.${tab} .${listName}`).prepend(template);\n      }\n    }\n  }\n\n  /**\n   * Adds spell tooltips to magic items on spells tab\n   *\n   * @param {*} element\n   */\n  addToolTips(element) {\n    if (\"tooltip\" in element.dataset) return;\n    const target = element.closest(\"[data-item-id], [data-uuid]\"); // TODO why data-uuid ?\n    const uuid = target.dataset?.itemUuid;\n    if (!uuid) return;\n    // TODO why data-uuid ?\n    element.dataset.tooltip = `\n      <section class=\"loading\" data-uuid=\"${uuid}\"><i class=\"fas fa-spinner fa-spin-pulse\"></i></section>\n    `;\n    element.dataset.tooltipClass = \"dnd5e2 dnd5e-tooltip item-tooltip\";\n    element.dataset.tooltipDirection ??= \"LEFT\";\n  }\n\n  /**\n   *\n   */\n  static handleEvents(html, actor) {\n    if (!actor.isUsingNew5eSheet) {\n      html.find(\".item div.magic-item-image\").click((evt) => MagicItemSheet.onItemRoll(evt, actor));\n      html.find(\".item h4.spell-name\").click((evt) => MagicItemSheet.onItemShow(evt));\n    } else {\n      html.find(\".item.magic-item .item-name\").click((evt) => MagicItemSheet.onItemRoll(evt, actor));\n    }\n    MagicItemSheet.handleActorItemUsesChangeEvents(html, actor);\n    MagicItemSheet.handleMagicItemDragStart(html, actor);\n  }\n\n  static handleMagicItemDragStart(html, actor) {\n    html.find(`li.item.magic-item`).each((i, li) => {\n      li.addEventListener(\"dragstart\", (evt) => MagicItemSheet.onDragItemStart(evt, actor));\n    });\n  }\n\n  static handleActorItemUsesChangeEvents(html, actor) {\n    actor.items.forEach((item) => {\n      html.find(`input[data-item-uses=\"magicitems.${item.id}.uses\"]`).change((evt) => {\n        item.setUses(MagicItemHelpers.numeric(evt.currentTarget.value, item.uses));\n        item.update();\n      });\n      item.ownedEntries.forEach((entry) => {\n        html.find(`input[data-item-uses=\"magicitems.${item.id}.${entry.id}.uses\"]`).change((evt) => {\n          entry.uses = MagicItemHelpers.numeric(evt.currentTarget.value, entry.uses);\n          item.update();\n        });\n      });\n    });\n  }\n\n  /**\n   *\n   * @param evt\n   */\n  static async onItemRoll(evt, actor) {\n    evt.preventDefault();\n    let dataset = evt.currentTarget.closest(\".item\").dataset;\n    let magicItemId = dataset.magicItemId;\n    let itemId = dataset.itemId;\n    await actor.roll(magicItemId, itemId);\n    // this.render();\n  }\n\n  /**\n   *\n   * @param evt\n   */\n  static async onItemShow(evt) {\n    evt.preventDefault();\n    let dataset = evt.currentTarget.closest(\".item\").dataset;\n    let itemId = dataset.itemId;\n    let itemUuid = dataset.itemUuid;\n    let itemPack = dataset.itemPack;\n\n    let uuid = null;\n    if (itemUuid) {\n      uuid = itemUuid;\n    } else {\n      uuid = RetrieveHelpers.retrieveUuid({\n        documentName: null,\n        documentId: itemId,\n        documentCollectionType: \"Item\",\n        documentPack: itemPack,\n      });\n    }\n    const itemTmp = await fromUuid(uuid);\n    if (itemTmp) {\n      itemTmp.ownership.default = CONST.DOCUMENT_OWNERSHIP_LEVELS.LIMITED;\n      itemTmp.sheet.render(true);\n    } else {\n      Logger.error(`An item with UUID ${uuid} could not be found. Please verify.`);\n    }\n  }\n\n  /**\n   *\n   * @param evt\n   */\n  static onDragItemStart(evt, actor) {\n    const li = evt.currentTarget;\n    let magicItemId = li.dataset.magicItemId;\n    let itemId = li.dataset.itemId;\n    let magicItem = actor.magicItem(magicItemId);\n    let item = magicItem.entryBy(itemId);\n\n    const dragData = {\n      type: \"MagicItem\",\n      name: `${magicItem.name} > ${item.name}`,\n      img: item.img,\n      magicItemName: magicItem.name,\n      itemName: item.name,\n    };\n    evt.dataTransfer.setData(\"text/plain\", JSON.stringify(dragData));\n  }\n}\n","import CONSTANTS from \"../constants/constants.js\";\nimport Logger from \"../lib/Logger.js\";\nimport { isEmptyObject } from \"../lib/lib.js\";\nimport { RetrieveHelpers } from \"../lib/retrieve-helpers.js\";\nimport { MagicItemHelpers } from \"../magic-item-helpers.js\";\nimport { MagicItemTab } from \"../magicItemtab.js\";\nimport { MagicItemActor } from \"../magicitemactor.js\";\nimport { MagicItemSheet } from \"../magicitemsheet.js\";\n\n/**\n * Create a new API class and export it as default\n */\nconst API = {\n  /**\n   * Method for create and register a new MagicItemActor.\n   * @param {string/Actor/UUID} actor The actor to use for retrieve the Actor\n   * @returns {Actor}\n   */\n  actor: async function (actor) {\n    const actorTmp = await RetrieveHelpers.getActorAsync(actor);\n    return MagicItemActor.get(actorTmp.id);\n  },\n\n  /**\n   * Method for roll and show a chat message on the chat console\n   * @param {string} magicItemName The name of the magic item to use\n   * @param {string} innerChildMagicItemName The name of the inner child \"magic item\" to use\n   * @returns {void} Return no response\n   */\n  roll: function (magicItemName, innerChildMagicItemName) {\n    const ChatMessage5e = CONFIG.ChatMessage.documentClass;\n    const speaker = ChatMessage5e.getSpeaker();\n    let actor;\n    if (speaker.token) {\n      actor = game.actors.tokens[speaker.token];\n    }\n    if (!actor) {\n      actor = game.actors.get(speaker.actor);\n    }\n    const magicItemActor = actor ? MagicItemActor.get(actor.id) : null;\n    if (!magicItemActor) {\n      Logger.warn(game.i18n.localize(\"MAGICITEMS.WarnNoActor\"), true);\n      return;\n    }\n    magicItemActor.rollByName(magicItemName, innerChildMagicItemName);\n  },\n\n  /**\n   * Setup Magic item like you normally would by creating a spell called with all the damage details in the spell as detailed on the weapon.\n   * Also checkes for Item Attunement and gives you a choice if you want to spend a charge or not.\n   * @param {Item/string/UUID} item\n   * @returns {void}\n   */\n  async magicItemAttack(item) {\n    let itemD = await RetrieveHelpers.getItemAsync(item);\n    if (!itemD) {\n      Logger.warn(`magicItemAttack | No item found with this reference '${item}'`, true, item);\n      return false;\n    }\n    if (game.user.targets.size !== 1) {\n      Logger.warn(\"magicItemAttack | Please target only one token.\", true);\n      return false;\n    }\n\n    let spells = foundry.utils.getProperty(itemD, `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.SPELLS}`) || [];\n    if (spells.length === 0) {\n      Logger.warn(\"magicItemAttack | Please put at least one spells on the item.\", true);\n      return false;\n    }\n    let attunement = itemD.system.attunement;\n    let target = game.user.targets.first(); // await canvas.tokens.get(args[0].hitTargets[0]._id);\n    if (target && attunement === 2) {\n      new Dialog({\n        title: `${itemD.name}`,\n        content: `<p>Spend a charge?</p>`,\n        buttons: {\n          confirmed: {\n            icon: \"<i class='fas fa-bolt'></i>\",\n            label: \"Yes\",\n            callback: async () => {\n              await this.roll(itemD.name, spells[0].name);\n            },\n          },\n        },\n      }).render(true);\n    }\n  },\n\n  /**\n   * Setup Magic item like you normally would by creating a spell called with all the damage details in the spell as detailed on the weapon.\n   * @param {Item/string/UUID} item\n   * @returns {Promise<void>} No Response\n   */\n  async magicItemAttackFast(item) {\n    let itemD = await RetrieveHelpers.getItemAsync(item);\n    if (!itemD) {\n      Logger.warn(`magicItemAttackFast | No item found with this reference '${item}'`, true, item);\n      return false;\n    }\n    let spells = foundry.utils.getProperty(itemD, `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.SPELLS}`) || [];\n    if (spells.length === 0) {\n      Logger.warn(\"magicItemAttackFast | Please put at least one spells on the item.\", true);\n      return false;\n    }\n    await this.roll(itemD.name, spells[0].name);\n  },\n\n  /**\n   * Setup Magic item like you normally would by creating a spell called with all the damage details in the spell as detailed on the weapon.\n   * @param {Item|string|UUID} item\n   * @returns {Promise<void>} No Response\n   */\n  async magicItemMultipleSpellsTrinket(item) {\n    let itemD = await RetrieveHelpers.getItemAsync(item);\n    if (!itemD) {\n      Logger.warn(`multipleSpellsTrinket | No item found with this reference '${item}'`, true, item);\n      return false;\n    }\n    if (game.user.targets.size !== 1) {\n      Logger.warn(\"multipleSpellsTrinket | Please target only one token.\", true);\n      return false;\n    }\n    let spellList = \"\";\n    let spells = foundry.utils.getProperty(itemD, `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.SPELLS}`) || [];\n    if (spells.length === 0) {\n      Logger.warn(\"multipleSpellsTrinket | Please put at least one spells on the item.\", true);\n      return false;\n    }\n    let spell_items = Object.values(spells).sort((a, b) => (a.name < b.name ? -1 : 1));\n    for (let i = 0; i < spell_items.length; i++) {\n      let item = spell_items[i];\n      spellList += `<option value=\"${item.name}\">${item.name}</option>`;\n    }\n\n    const htmlContent = `<form>\n            <p>Pick a spell to cast</p>\n            <div class=\"form-group\">\n                <label for=\"weapons\">Listed Spells</label>\n                <select id=\"spells\">${spellList}</select>\n            </div>\n        </form>`;\n\n    new Dialog({\n      title: `${itemD.name}`,\n      content: htmlContent,\n      buttons: {\n        cast: {\n          label: \"Cast\",\n          callback: async (html) => {\n            let get_spell = await html.find(\"#spells\")[0].value;\n            await this.roll(itemD.name, get_spell);\n          },\n        },\n      },\n    }).render(true);\n  },\n\n  /**\n   * If there are multiple spells on said item, you can use this macro. Just enter the name of the item.\n   * @param {Item|string|UUID} item\n   * @param {boolean} runAsItemMacro Run as a item macro with the command `game.dnd5e.rollItemMacro(itemName)`\n   * @returns {Promise<void>} No Response\n   */\n  async magicItemMultipleSpellsWeapon(item, runAsItemMacro) {\n    let itemD = await RetrieveHelpers.getItemAsync(item);\n    if (!itemD) {\n      Logger.warn(`multipleSpellsWeapon | No item found with this reference '${item}'`, true, item);\n      return false;\n    }\n    if (game.user.targets.size !== 1) {\n      Logger.warn(\"multipleSpellsWeapon | Please target only one token.\", true);\n      return false;\n    }\n    let spellList = \"\";\n    let spells = foundry.utils.getProperty(itemD, `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.SPELLS}`) || [];\n    let spell_items = Object.values(spells).sort((a, b) => (a.name < b.name ? -1 : 1));\n    for (let i = 0; i < spell_items.length; i++) {\n      let item = spell_items[i];\n      spellList += `<option value=\"${item.name}\">${item.name}</option>`;\n    }\n    if (!runAsItemMacro) {\n      const htmlContent = `<form>\n            <p>Pick a spell to cast</p>\n            <div class=\"form-group\">\n                <label for=\"weapons\">Listed Spells</label>\n                <select id=\"spells\">${spellList}</select>\n            </div>\n        </form>`;\n\n      new Dialog({\n        title: `${itemD.name}`,\n        content: htmlContent,\n        buttons: {\n          cast: {\n            label: \"Cast\",\n            callback: async (html) => {\n              let get_spell = await html.find(\"#spells\")[0].value;\n              await this.roll(itemD.name, get_spell);\n            },\n          },\n        },\n      }).render(true);\n    } else {\n      game.dnd5e.rollItemMacro(itemName);\n    }\n  },\n\n  /**\n   * Method handling a short-rest action for magic items for an actor.\n   * @param {string/Actor/UUID} actor The actor to use for retrieve the Actor\n   * @param {Boolean} isNewDay Check whether it's a new day\n   * @returns {Promise<void>} No response\n   */\n  async execActorShortRest(actor, isNewDay) {\n    let actorTmp = await API.actor(actor);\n    actorTmp.items.forEach(async (item) => {\n      await item.onShortRest();\n      if (isNewDay) await item.onNewDay();\n    });\n  },\n\n  /**\n   * Method handling a long-rest action for magic items for an actor.\n   * @param {string/Actor/UUID} actor The actor to use for retrieve the Actor\n   * @param {Boolean} isNewDay Check whether it's a new day\n   * @returns {Promise<void>} No response\n   */\n  async execActorLongRest(actor, isNewDay) {\n    let actorTmp = await API.actor(actor);\n    actorTmp.items.forEach(async (item) => {\n      await item.onLongRest();\n      if (isNewDay) await item.onNewDay();\n    });\n  },\n};\n\nexport default API;\n","import CONSTANTS from \"../constants/constants.js\";\nimport Logger from \"../lib/Logger.js\";\nimport { isEmptyObject } from \"../lib/lib.js\";\nimport { RetrieveHelpers } from \"../lib/retrieve-helpers.js\";\nimport { MagicItemHelpers } from \"../magic-item-helpers.js\";\nimport { MagicItemTab } from \"../magicItemtab.js\";\nimport { MagicItemActor } from \"../magicitemactor.js\";\nimport { MagicItemSheet } from \"../magicitemsheet.js\";\n\nconst MIGRATION = {\n  /**\n   * Utility method to migrate the scope flag from 'magic-items-2' to 'magicitems'\n   * @returns {Promise<void>} No Response\n   */\n  async migrateScopeMagicItem() {\n    if (game.user.isGM) {\n      for (const a of game.actors) {\n        Logger.info(`Update flagsScope on actor ${a.name}...`);\n        const magicitems = a.items.filter((i) => !!i.flags[\"magic-items-2\"]);\n        if (magicitems?.length > 0) {\n          for (const mi of magicitems) {\n            Logger.info(`Update flagsScope on actor ${a.name} for item ${mi.name}...`);\n            await this.updateFlagScopeMagicItem(mi);\n            Logger.info(`Updated flagsScope on actor ${a.name} for item ${mi.name}`);\n          }\n          Logger.info(`Updated flagsScope on actor ${a.name}`);\n        }\n      }\n    }\n  },\n\n  /**\n   * Utility method to migrate the scope flag from 'magic-items-2' to 'magicitems'\n   * @param {object} mi The flags property to check\n   * @returns {Promise<void>} No Response\n   */\n  async updateFlagScopeMagicItem(mi) {\n    const miFlag = foundry.utils.getProperty(mi, `flags.magic-items-2`);\n    const miFlagNewScope = foundry.utils.getProperty(mi, `flags.${CONSTANTS.MODULE_ID}`);\n    if (!isEmptyObject(miFlag) && isEmptyObject(miFlagNewScope)) {\n      Logger.info(`Update flagsScope item ${mi.name}...`);\n      if (miFlag.spells?.length > 0) {\n        Object.entries(miFlag.spells).forEach(([key, value]) => {\n          if (!value.uuid && value.id) {\n            value.uuid = `Item.${value.id}`;\n          }\n        });\n      }\n      if (miFlag.feats?.length > 0) {\n        Object.entries(miFlag.feats).forEach(([key, value]) => {\n          if (!value.uuid && value.id) {\n            value.uuid = `Item.${value.id}`;\n          }\n        });\n      }\n      await mi.update({\n        flags: {\n          [CONSTANTS.MODULE_ID]: miFlag,\n        },\n      });\n      Logger.info(`Updated flagsScope item ${mi.name}`);\n    }\n  },\n\n  /**\n   * Method to migrate compendiumpack to use another flag\n   * @param {string} compendiumName the name of the pack, gotten from the `game.packs` property\n   * @returns {Promise<void>} No Response\n   */\n  async updateScopePerCompendiumPack(compendiumName) {\n    if (game.user.isGM) {\n      const previousPackageName = \"magic-items-2\";\n      if (game.packs.get(`${compendiumName}`) !== undefined) {\n        await game.packs.get(`${compendiumName}`).updateAll((pack) => ({\n          flags: {\n            [CONSTANTS.MODULE_ID]: pack.flags[`${previousPackageName}`],\n          },\n        }));\n        Logger.info(`Updated flagsScope for compendium ${compendiumName}`);\n      } else {\n        Logger.warn(`Pack ${compendiumName} has not been found - no migration applied`);\n      }\n    }\n  },\n\n  /**\n   * Update all actor magicitems item flags\n   */\n  async updatMagicItemsOnAllActors() {\n    if (game.user.isGM) {\n      Logger.info(`Updating Magic Items information on all actors`);\n      for (const actor of game.actors) {\n        Logger.info(`Updating Magic Items on actor ${actor.name}`);\n        const miFlag = actor.items.filter((i) => !!i.flags[CONSTANTS.MODULE_ID]);\n        if (miFlag?.length > 0) {\n          for (const item of miFlag) {\n            await MagicItemHelpers.updateMagicItemFlagOnItem(item);\n          }\n        }\n      }\n    }\n  },\n\n  /**\n   * Method that updates all compendium items with new Magic Item flags.\n   * @param {*} compendiumName compendium name fetched from game.packs\n   */\n  async updateMagicItemsOnAllCompendiumItems(compendiumName) {\n    if (game.user.isGM) {\n      Logger.info(`Updating all items from compendium '${compendiumName}' with new flags`);\n      const compendiumItems = await game.packs.get(compendiumName)?.getDocuments();\n      if (!isEmptyObject(compendiumItems)) {\n        const miFlag = compendiumItems.filter((i) => !!i.flags[CONSTANTS.MODULE_ID]);\n        if (miFlag?.length > 0) {\n          for (const item of miFlag) {\n            Logger.debug(`${JSON.stringify(item)}`);\n            Logger.info(`Updating components on item ${item.name}`);\n            await MagicItemHelpers.updateMagicItemFlagOnItem(item);\n          }\n        }\n      }\n    }\n  },\n};\n\nexport default MIGRATION;\n","import API from \"./scripts/API/api.js\";\nimport MIGRATION from \"./scripts/API/migration.js\";\nimport CONSTANTS from \"./scripts/constants/constants.js\";\nimport { MagicItemActor } from \"./scripts/magicitemactor.js\";\nimport { MagicItemSheet } from \"./scripts/magicitemsheet.js\";\nimport { MagicItemTab } from \"./scripts/magicItemtab.js\";\nimport { MagicItem } from \"./scripts/magic-item/MagicItem.js\";\n\n// CONFIG.debug.hooks = true;\n\nHandlebars.registerHelper(\"enabled\", function (value, options) {\n  return Boolean(value) ? \"\" : \"disabled\";\n});\n\nHandlebars.registerHelper(\"formatString\", function (toFormat, variables = {}) {\n  return game.i18n.format(toFormat, variables);\n});\n\nHandlebars.registerHelper(\"object\", function ({ hash }) {\n  return hash;\n});\n\nHooks.once(\"init\", () => {\n  game.settings.register(CONSTANTS.MODULE_ID, \"identifiedOnly\", {\n    name: \"MAGICITEMS.SettingIdentifiedOnly\",\n    hint: \"MAGICITEMS.SettingIdentifiedOnlyHint\",\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"hideFromPlayers\", {\n    name: \"MAGICITEMS.SettingHideFromPlayers\",\n    hint: \"MAGICITEMS.SettingHideFromPlayersHint\",\n    scope: \"world\",\n    type: Boolean,\n    default: false,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"debug\", {\n    name: \"MAGICITEMS.SettingDebug\",\n    hint: \"MAGICITEMS.SettingDebugHint\",\n    scope: \"client\",\n    type: Boolean,\n    default: false,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"welcomeMessage\", {\n    name: \"welcomeMessage\",\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: false,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"scaleSpellDamage\", {\n    name: \"MAGICITEMS.SettingScaleSpellDamage\",\n    hint: \"MAGICITEMS.SettingScaleSpellDamageHint\",\n    scope: \"world\",\n    type: Boolean,\n    default: false,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"showLeftChargesChatMessage\", {\n    name: \"MAGICITEMS.SettingShowLeftChargesInChat\",\n    hint: \"MAGICITEMS.SettingShowLeftChargesInChatHint\",\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"optionDisplayMainSheetItems\", {\n    name: \"MAGICITEMS.SettingDisplayMainSheetItem\",\n    hint: \"MAGICITEMS.SettingDisplayMainSheetItemHint\",\n    scope: \"client\",\n    type: Number,\n    default: CONSTANTS.DISPLAY_OPTIONS.BOTTOM,\n    requiresReload: true,\n    choices: {\n      0: \"MAGICITEMS.SettingDisplayMainSheetItemBottom\",\n      1: \"MAGICITEMS.SettingDisplayMainSheetItemTop\",\n    },\n    config: true,\n  });\n\n  if (typeof Babele !== \"undefined\") {\n    game.babele.register({\n      module: CONSTANTS.MODULE_ID,\n      lang: \"en\",\n      dir: \"languages/packs/en\",\n    });\n    game.babele.register({\n      module: CONSTANTS.MODULE_ID,\n      lang: \"it\",\n      dir: \"languages/packs/it\",\n    });\n    game.babele.register({\n      module: CONSTANTS.MODULE_ID,\n      lang: \"pl\",\n      dir: \"languages/packs/pl\",\n    });\n  }\n});\n\nHooks.once(\"setup\", async () => {\n  // Set API\n  game.modules.get(CONSTANTS.MODULE_ID).api = API;\n  window.MagicItems = game.modules.get(CONSTANTS.MODULE_ID).api;\n  game.modules.get(CONSTANTS.MODULE_ID).migration = MIGRATION;\n});\n\nHooks.once(\"ready\", async () => {\n  Array.from(game.actors)\n    .filter((actor) => actor.permission >= 1)\n    .forEach((actor) => {\n      MagicItemActor.bind(actor);\n    });\n\n  if (game.user.isGM && !game.settings.get(CONSTANTS.MODULE_ID, \"welcomeMessage\")) {\n    const message =\n      \"Hello everyone!<br><br>This is the first version of Magic Items module that has been transferred from Magic Items 2, therefore it requires a migration of items.<br><br>For manual information about migrations, please consult the latest release changelog.<br><br>Thank you for your continuing support, and I hope you will enjoy this module!<br><br>If you want, please go ahead and check out the discord community created for this module on Foundry Module listing or Github project.\";\n    const title = \"Magic Items\";\n    // eslint-disable-next-line no-undef\n    let d = new Dialog({\n      title: title,\n      content: `${message}<br><br>`,\n      buttons: {\n        use: {\n          icon: '<i class=\"fas fa-check\"></i>',\n          label: \"Do the automatic migration.\",\n          callback: () => {\n            MIGRATION.migrateScopeMagicItem();\n            game.settings.set(CONSTANTS.MODULE_ID, \"welcomeMessage\", true);\n          },\n        },\n        closeAndChangeSetting: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: \"I will do the migration on my own - do not show this window again.\",\n          callback: () => {\n            game.settings.set(CONSTANTS.MODULE_ID, \"welcomeMessage\", true);\n            d.close();\n          },\n        },\n        close: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n.localize(\"MAGICITEMS.SheetDialogClose\"),\n          callback: () => d.close(),\n        },\n      },\n      default: \"use\",\n    });\n    d.render(true);\n  }\n});\n\nHooks.once(\"createActor\", (actor) => {\n  if (actor.permission >= 2) {\n    MagicItemActor.bind(actor);\n  }\n});\n\nHooks.once(\"createToken\", (token) => {\n  const actor = token.actor;\n  if (actor.permission >= 2) {\n    MagicItemActor.bind(actor);\n  }\n});\n\nlet tidyApi;\nHooks.once(\"tidy5e-sheet.ready\", (api) => {\n  tidyApi = api;\n\n  // Register Tidy Item Sheet Tab\n  const magicItemsTab = new api.models.HandlebarsTab({\n    title: \"Magic Item\",\n    tabId: \"magicitems\",\n    path: \"/modules/magicitems/templates/magic-item-tab.hbs\",\n    enabled: (data) => {\n      return MagicItemTab.isAcceptedItemType(data.item) && MagicItemTab.isAllowedToShow();\n    },\n    getData(data) {\n      const flagsData = foundry.utils.getProperty(data.item, `flags.${CONSTANTS.MODULE_ID}`);\n      return new MagicItem(flagsData);\n    },\n    onRender(params) {\n      const html = $(params.element);\n\n      if (params.data.editable) {\n        const flagsData = foundry.utils.getProperty(params.data.item, `flags.${CONSTANTS.MODULE_ID}`);\n        const magicItem = new MagicItem(flagsData);\n        MagicItemTab.activateTabContentsListeners({\n          html: html,\n          item: params.data.item,\n          magicItem: magicItem,\n        });\n        params.element.querySelector(`.magicitems-content`).addEventListener(\"drop\", (event) => {\n          MagicItemTab.onDrop({ event, item: params.data.item, magicItem: magicItem });\n        });\n      } else {\n        MagicItemTab.disableMagicItemTabInputs(html);\n      }\n    },\n  });\n  api.registerItemTab(magicItemsTab);\n\n  // Register character and NPC spell tab custom content\n  api.registerActorContent(\n    new api.models.HandlebarsContent({\n      path: `modules/${CONSTANTS.MODULE_ID}/templates/magic-item-spell-sheet.html`,\n      injectParams: {\n        position: \"afterbegin\",\n        selector: `[data-tab-contents-for=\"${api.constants.TAB_ID_CHARACTER_SPELLBOOK}\"] .scroll-container`,\n      },\n      enabled(data) {\n        const magicItemActor = MagicItemActor.get(data.actor.id);\n        if (!magicItemActor) {\n          return false;\n        }\n        // Required for Tidy to have accurate item data\n        magicItemActor.buildItems();\n        return [\"character\", \"npc\"].includes(data.actor.type) && magicItemActor.hasItemsSpells();\n      },\n      getData(data) {\n        return MagicItemActor.get(data.actor.id);\n      },\n    }),\n  );\n\n  // Register character and NPC feature tab custom content\n  const npcAbilitiesTabContainerSelector = `[data-tidy-sheet-part=\"${api.constants.SHEET_PARTS.NPC_ABILITIES_CONTAINER}\"]`;\n  const characterFeaturesContainerSelector = `[data-tab-contents-for=\"${api.constants.TAB_ID_CHARACTER_FEATURES}\"] [data-tidy-sheet-part=\"${api.constants.SHEET_PARTS.ITEMS_CONTAINER}\"]`;\n  const magicItemFeatureTargetSelector = [npcAbilitiesTabContainerSelector, characterFeaturesContainerSelector].join(\n    \", \",\n  );\n  api.registerActorContent(\n    new api.models.HandlebarsContent({\n      path: `modules/${CONSTANTS.MODULE_ID}/templates/magic-item-feat-sheet.html`,\n      injectParams: {\n        position: \"afterbegin\",\n        selector: magicItemFeatureTargetSelector,\n      },\n      enabled(data) {\n        const magicItemActor = MagicItemActor.get(data.actor.id);\n        if (!magicItemActor) {\n          return false;\n        }\n        // Required for Tidy to have accurate item data\n        magicItemActor.buildItems();\n        return [\"character\", \"npc\"].includes(data.actor.type) && magicItemActor.hasItemsFeats();\n      },\n      getData(data) {\n        return MagicItemActor.get(data.actor.id);\n      },\n    }),\n  );\n});\n\n// Wire Tidy events and register iterated, data-dependent content\nHooks.on(\"tidy5e-sheet.renderActorSheet\", (app, element, data) => {\n  // Place wand for visible magic items\n  const magicItemActor = MagicItemActor.get(data.actor.id);\n  const html = $(element);\n  if (!magicItemActor) {\n    return;\n  }\n\n  magicItemActor.items\n    .filter((item) => item.visible)\n    .forEach((item) => {\n      let itemEl = html.find(\n        `[data-tidy-sheet-part=\"${tidyApi.constants.SHEET_PARTS.ITEM_TABLE_ROW}\"][data-item-id=\"${item.id}\"]`,\n      );\n      let itemNameContainer = itemEl.find(`[data-tidy-sheet-part=${tidyApi.constants.SHEET_PARTS.ITEM_NAME}]`);\n      let iconHtml = tidyApi.useHandlebarsRendering(CONSTANTS.HTML.MAGIC_ITEM_ICON);\n      itemNameContainer.append(iconHtml);\n    });\n\n  // Wire events for custom tidy actor sheet content\n  MagicItemSheet.handleEvents(html, magicItemActor);\n});\n\nHooks.on(`renderItemSheet5e`, (app, html, data) => {\n  if (tidyApi?.isTidy5eItemSheet(app)) {\n    return;\n  }\n\n  if (!MagicItemTab.isAllowedToShow()) {\n    return;\n  }\n\n  MagicItemTab.bind(app, html, data);\n});\n\nHooks.on(`renderActorSheet5eCharacter`, (app, html, data) => {\n  if (tidyApi?.isTidy5eCharacterSheet(app)) {\n    return;\n  }\n  MagicItemSheet.bind(app, html, data);\n});\n\nHooks.on(`renderActorSheet5eNPC`, (app, html, data) => {\n  if (tidyApi?.isTidy5eNpcSheet(app)) {\n    return;\n  }\n  MagicItemSheet.bind(app, html, data);\n});\n\nHooks.on(\"hotbarDrop\", async (bar, data, slot) => {\n  if (data.type !== \"MagicItem\") {\n    return;\n  }\n  const command = `MagicItems.roll(\"${data.magicItemName}\",\"${data.itemName}\");`;\n  let macro = game.macros.find((m) => m.name === data.name && m.command === command);\n  if (!macro) {\n    macro = await Macro.create(\n      {\n        name: data.name,\n        type: \"script\",\n        img: data.img,\n        command: command,\n        flags: { \"dnd5e.itemMacro\": true },\n      },\n      { displaySheet: false },\n    );\n  }\n  game.user.assignHotbarMacro(macro, slot);\n\n  return false;\n});\n\nHooks.on(\"createItem\", async (item, options, userId) => {\n  if (item.actor) {\n    const actor = item.actor;\n    const miActor = MagicItemActor.get(actor.id);\n    if (miActor && miActor.listening && miActor.actor.id === actor.id) {\n      await MIGRATION.updateFlagScopeMagicItem(item);\n      await miActor.buildItems();\n    }\n  }\n});\n\nHooks.on(\"updateItem\", async (item, change, options, userId) => {\n  if (item.actor) {\n    const actor = item.actor;\n    const miActor = MagicItemActor.get(actor.id);\n    if (miActor && item.flags.magicitems?.internal) {\n      const miItem = miActor.magicItem(item.id);\n      if (miItem) {\n        await miItem.updateInternalCharges(item.flags.magicitems?.internal, item);\n        miItem.rechargeableLabel = miItem.getRechargeableLabel();\n        miItem.update();\n      }\n    }\n    if (miActor && miActor.listening && miActor.actor.id === actor.id) {\n      setTimeout(miActor.buildItems.bind(miActor), 500);\n    }\n  }\n});\n\nHooks.on(\"deleteItem\", async (item, options, userId) => {\n  if (item.actor) {\n    const actor = item.actor;\n    const miActor = MagicItemActor.get(actor.id);\n    if (miActor && miActor.listening && miActor.actor.id === actor.id) {\n      await miActor.buildItems();\n    }\n  }\n});\n\nHooks.on(\"preCreateItem\", async (item, data, options, userId) => {\n  const actorEntity = item.actor;\n  if (!actorEntity) {\n    return;\n  }\n});\n\nHooks.on(\"preUpdateItem\", async (item, changes, options, userId) => {\n  const actorEntity = item.actor;\n  if (!actorEntity) {\n    return;\n  }\n});\n\nHooks.on(\"preDeleteItem\", async (item, options, userId) => {\n  const actorEntity = item.actor;\n  if (!actorEntity) {\n    return;\n  }\n});\n"],"names":["pack","entity","dialog","html","item","itemName"],"mappings":"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"}